<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Kiểm Tra Tổng Hợp - Xử Lý Ảnh (Ôn tập)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #1c1e21;
        }
        #user-info {
            position: fixed;
            top: 15px;
            left: 20px;
            background-color: rgba(0, 86, 179, 0.1);
            color: #0056b3;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 200;
            border: 1px solid rgba(0, 86, 179, 0.2);
        }
        #test-container {
            max-width: 900px;
            margin: auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #dddfe2;
        }
        h1 {
            text-align: center;
            color: #0056b3;
            margin-bottom: 10px;
        }
        #results {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0 30px 0;
            padding: 10px;
            background-color: #e7f3ff;
            color: #0056b3;
            border-radius: 8px;
            position: sticky;
            top: 10px;
            z-index: 100;
        }
        .question-block {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .question-text {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .options-container div {
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid transparent;
        }
        label {
            margin-left: 10px;
            cursor: pointer;
        }
        input[type="radio"] {
            cursor: pointer;
        }
        fieldset {
            border: none;
            padding: 0;
            margin: 0;
        }
        fieldset:disabled {
            opacity: 0.7;
        }
        fieldset:disabled label {
            cursor: not-allowed;
        }
        .question-block.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .question-block.incorrect {
            background-color: #fff1f2; /* Lighter red for the block */
            border-color: #f5c6cb;
        }
        .options-container div.incorrect-option {
             background-color: #f8d7da; /* Stronger red for the specific wrong option */
             border-color: #f5c6cb;
        }
        .correct-answer {
            margin-top: 15px;
            font-weight: bold;
            color: #155724;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
            display: none; /* Initially hidden */
        }
        .correct-answer.visible {
            display: block;
        }
        .note {
            font-size: 0.9em;
            color: #555;
            margin-left: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="user-info">Thanh Hưng K62</div>
    <div id="test-container">
        <h1>Bài Kiểm Tra Tổng Hợp Xử Lý Ảnh (Chế độ ôn tập)</h1>
        <div id="results">Điểm số: 0 / 81</div>
        
        <form id="quiz-form">
            </form>
    </div>

    <script>
    // --- DATA SECTION (81 Unique Questions) ---
   const quizData = [
    { id: 1, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[0, 1, 0], [1, -4, 1], [0, 1, 0]]) là bộ lọc nào?", options: { A: "Bộ lọc trung bình", B: "Bộ lọc Gaussian", C: "Bộ lọc sắc nét", D: "Bộ lọc thông thấp" }, answer: "C" },
    { id: 2, question: "Bộ lọc nào được sử dụng để tìm điểm sáng nhất trong ảnh?", options: { A: "Bộ lọc trung bình", B: "Không đáp án nào đúng", C: "Bộ lọc cực đại", D: "Bộ lọc trung vị" }, answer: "C" },
    { id: 3, question: "Trong kỹ thuật lọc ảnh, thuật ngữ nào được sử dụng để mô tả phép nhân các điểm ảnh với các hệ số khác nhau trong ma trận lọc?", options: { A: "Lọc trung bình trong miền không gian", B: "Lọc trung bình có trọng số", C: "Không đáp án nào đúng", D: "Lọc trung bình bình phương" }, answer: "B" },
    { id: 4, question: "Đầu ra của bộ lọc làm trơn ảnh, tuyến tính trong miền không gian là", options: { A: "Giá trị trung vị của các điểm ảnh", B: "Giá trị trung bình của các điểm ảnh", C: "Giá trị lớn nhất của các điểm ảnh", D: "Giá trị nhỏ nhất của các điểm ảnh" }, answer: "B" },
    { id: 5, question: "Phần tử cấu trúc SE chạy dịch chuyển trên của ảnh", options: { A: "từng cột", B: "từng đường biên", C: "từng điểm ảnh", D: "từng hàng" }, answer: "C" },
    { id: 6, question: "Trong toán tử hình thái, SE là viết tắt của cụm từ nào Sau đây?", options: { A: "Structuring elements", B: "Software engineer", C: "Structure eliminate", D: "Software engineering" }, answer: "A" },
    { id: 7, question: "Đáp ứng ra của bộ lọc làm trơn, tuyến tính trong miền không gian là", options: { A: "Không đáp án nào đúng", B: "Tổng các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", C: "Tích các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", D: "Giá trị trung bình của các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc" }, answer: "D" },
    { id: 8, question: "Phần tử cấu trúc còn được gọi là", options: { A: "nhiễu (noise)", B: "ảnh con (Sub-image)", C: "các điểm ảnh (pixel)", D: "các đường thẳng (lines)" }, answer: "B" },
    { id: 9, question: "Sự thay đổi cường độ sáng có thể được phát hiện thông qua", options: { A: "phép tích phân", B: "phép toán đạo hàm", C: "phép trừ", D: "phép cộng" }, answer: "B" },
    { id: 10, question: "Bộ lọc thông cao được Sử dụng để", options: { A: "làm Sắc nét ảnh", B: "thay đổi kích thước ảnh", C: "làm mờ ảnh", D: "tăng cường độ tương phản của ảnh" }, answer: "A" },
    { id: 11, question: "Hai toán tử hình thái cơ bản là", options: { A: "phép giãn nở", B: "lý thuyết tập hơn", C: "phép xói mòn", D: "phép xói mòn và giãn nở" }, answer: "D" },
    { id: 12, question: "Trong xử lý ảnh, biến đổi Fourier biến đổi ảnh từ miền không gian sang", options: { A: "miền tần Số", B: "miền không gian", C: "miền Fourier", D: "miền thời gian" }, answer: "A" },
    { id: 13, question: "Bộ lọc nào sau đây được coi như là một dạng của bộ lọc thông thấp?", options: { A: "Tất cả các đáp án đều đúng", B: "Bộ lọc Butterworth", C: "Bộ lọc Gaussian", D: "Bộ lọc lý tưởng" }, answer: "A" },
    { id: 14, question: "Bộ lọc làm trơn ảnh được sử dụng để", options: { A: "Không đáp án nào đúng", B: "loại bỏ nhiễu và làm mờ ảnh", C: "loại bỏ nhiễu", D: "làm mờ ảnh" }, answer: "B" },
    { id: 15, question: "Toán tử nào thực hiện phép xói mòn trước và giãn nở sau?", options: { A: "Phép dịch", B: "Phép mở", C: "Phép đóng", D: "Phép làm mờ ảnh" }, answer: "B" },
    { id: 16, question: "Nếu hình bên trái tương ứng với tần số cắt Do = 15 thì tần số cắt của bộ lọc tương ứng với hình bên phải là bao nhiêu?", options: { A: "Do = 10", B: "Do = 20", C: "Do = 15", D: "Do = 5" }, answer: "D" },
    { id: 17, question: "Trong phép xói mòn, các chi tiết nhỏ hơn phần tử cấu trúc SE Sẽ được", options: { A: "nén", B: "dịch", C: "phản xạ", D: "lọc" }, answer: "D" },
    { id: 18, question: "Thuật ngữ nào không liên quan đến bộ lọc trong miền không gian", options: { A: "cửa sổ trượt (sliding window)", B: "Hàm mật độ xác suất (PDF)", C: "kernel", D: "mặt nạ không gian (spatial mask)" }, answer: "B" },
    { id: 19, question: "Bộ lọc được biểu diễn bởi phương trình: g(x,y) = f(x,y) - ∇²f(x,y) là bộ lọc gì?", options: { A: "Lọc thông thấp", B: "Lọc trung bình", C: "Lọc trung vị", D: "Lọc sắc nét" }, answer: "D" },
    { id: 20, question: "Phép tích chập trong miền không gian được biến đổi thành phép nhân trong miền", options: { A: "thời gian", B: "tần số", C: "không gian", D: "Không đáp án nào đúng" }, answer: "B" },
    { id: 21, question: "Nếu f(x, y) là cường độ sáng của điểm ảnh tại tọa độ (x, y). Đạo hàm bậc nhất theo phương x được tính như sau:", options: { A: "f(x-1,y) + f(x,y)", B: "f(x+1,y) - f(x,y)", C: "f(x-1,y) - f(x+1,y)", D: "f(x,y) - f(x+1,y)" }, answer: "B" },
    { id: 22, question: "Trong bài toán phát hiện biên, chúng ta thường sử dụng", options: { A: "đạo hàm bậc ba", B: "đạo hàm bậc nhất", C: "đạo hàm bậc hai", D: "đạo hàm bậc nhất và bậc hai" }, answer: "D" },
    { id: 23, question: "Phương trình H(u,v) = {1 if D(u,v)<=D0; 0 if D(u,v)>D0} biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông cao lý tưởng", B: "Bộ lọc thông thấp lý tưởng", C: "Bộ lọc thông thấp Butterworth", D: "Bộ lọc thông thấp Gauss" }, answer: "B" },
    { id: 24, question: "Mục tiêu cơ bản của kỹ thuật làm sắc nét ảnh là:", options: { A: "tăng độ sáng của ảnh", B: "giảm độ sáng của ảnh", C: "làm nổi bật các chi tiết trong ảnh", D: "làm nhòe ảnh (blurr)" }, answer: "C" },
    { id: 25, question: "Bình phương của độ lệch chuẩn được gọi là gì?", options: { A: "Phương Sai", B: "Không đáp án nào đúng", C: "Lũy thừa", D: "Nhiễu" }, answer: "A" },
    { id: 26, question: "Bộ lọc thực hiện thay thế giá trị cường độ Sáng của một điểm ảnh bởi giá trị cường độ sáng của điểm ảnh ở vị trí chính giữa của dãy điểm ảnh tương ứng với mặt nạ lọc, được gọi là", options: { A: "bộ lọc trung vị", B: "bộ lọc trung bình hình học", C: "bộ lọc trung bình không gian", D: "bộ lọc trung bình Số học" }, answer: "A" },
    { id: 27, question: "Biên được sinh ra bởi đạo hàm bậc nhất có độ dày như thế nào so với khi sử dụng đạo hàm bậc hai?", options: { A: "Độc lập với nhau", B: "Bằng nhau", C: "Dày hơn", D: "Mảnh hơn" }, answer: "C" },
    { id: 28, question: "Bộ lọc Sobel thường không hoạt động tốt cho bài toán phát hiện", options: { A: "đường chéo", B: "đường biên", C: "đường thẳng đứng", D: "đường nằm ngang" }, answer: "A" },
    { id: 29, question: "Toán tử giãn nở được Sử dụng để", options: { A: "nén ảnh", B: "mở rộng ảnh", C: "giải nén ảnh", D: "dịch ảnh" }, answer: "B" },
    { id: 30, question: "Bộ lọc thông cao cho qua__", options: { A: "tất cả các thành phần", B: "các thành phần có cường độ sáng cao", C: "các thành phần có cường độ sáng thấp", D: "các thành phần có cường độ sáng trung bình" }, answer: "B" },
    { id: 31, question: "Biểu thức H(u,v) = e^(-D²(u,v)/2D₀²) biểu diễn hàm truyền đạt của bộ lọc thông thấp nào?", options: { A: "Bộ lọc Butterworth", B: "Bộ lọc Gauss", C: "Không đáp án nào đúng", D: "Bộ lọc lý tưởng" }, answer: "B" },
    { id: 32, question: "Biểu thức H(u,v) = 1 / (1 + (D(u,v)/D₀)²ⁿ) biểu diễn hàm truyền đạt của bộ lọc thông thấp nào?", options: { A: "Bộ lọc Gauss", B: "Bộ lọc Butterworth", C: "Không đáp án nào đúng", D: "Bộ lọc lý tưởng" }, answer: "B" },
    { id: 33, question: "Giá trị trung bình của các điểm ảnh trong vùng không gian tương ứng với mặt nạ lọc là kết quả đầu ra của bộ lọc", options: { A: "Bộ lọc trung bình", B: "Cả ba đáp án còn lại đều đúng", C: "Bộ lọc thông thấp", D: "Bộ lọc làm trơn ảnh" }, answer: "B" },
    { id: 34, question: "Bộ lọc thay thế giá trị cường độ sáng của điểm ảnh bởi giá trị lớn nhất trong dãy điểm ảnh tương ứng với mặt nạ, được gọi là", options: { A: "bộ lọc trung bình", B: "bộ lọc cực tiểu", C: "bộ lọc trung vị", D: "bộ lọc cực đại" }, answer: "D" },
    { id: 35, question: "Ảnh biên độ Gradient được sử dụng trong bài toán", options: { A: "phát hiện biên", B: "phát hiện đường", C: "phát hiện vùng", D: "phát hiện điểm" }, answer: "A" },
    { id: 36, question: "Trong các phép toán tử hình thái, phần tử cấu trúc SE được coi như", options: { A: "mặt nạ tích chập", B: "mặt nạ tương quan", C: "bộ lọc thông thấp", D: "bộ lọc thông cao" }, answer: "A" },
    { id: 37, question: "Toán tử nào thực hiện phép giãn nở trước và phép xói mòn Sau?", options: { A: "Phép làm mờ ảnh", B: "Phép đóng", C: "Phép dịch", D: "Phép mở" }, answer: "B" },
    { id: 38, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[0, -1, 0], [-1, 5, -1], [0, -1, 0]]) là bộ lọc nào?", options: { A: "Bộ lọc trung bình", B: "Bộ lọc thông thấp", C: "Bộ lọc Gaussian", D: "Bộ lọc sắc nét" }, answer: "D" },
    { id: 39, question: "Với toán tử xói mòn, các đường bao của ảnh được", options: { A: "làm mờ", B: "co lại", C: "mở rộng", D: "Sắc nét" }, answer: "B" },
    { id: 40, question: "Bộ lọc trung bình được sử dụng trong các trường hợp nào sau đây?", options: { A: "Loại bỏ các chi tiết không liên quan trong ảnh", B: "Tất cả các đáp án đều đúng", C: "Loại bỏ nhiễu", D: "Làm mịn các đường biên bị lỗi" }, answer: "B" },
    { id: 41, question: "Hình vẽ sau (hình tròn đen trên nền trắng) biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông thấp", B: "Bộ lọc thông dải", C: "Bộ lọc chặn dải", D: "Bộ lọc thông cao" }, answer: "D" },
    { id: 42, question: "Phép đóng được biểu diễn bởi biểu thức nào Sau đây?", options: { A: "A ∘ B", B: "A - B", C: "A × B", D: "A . B" }, answer: "D" },
    { id: 43, question: "Nhiễu Gauss được hiểu là", options: { A: "nhiễu đen", B: "nhiễu đỏ", C: "nhiễu có phân bố chuẩn", D: "nhiễu trắng" }, answer: "C" },
    { id: 44, question: "Kết quả đầu ra của bộ lọc trung vị khi áp dụng vào ma trận ảnh [[15, 22, 35], [40, 45, 21], [1, 9, 26]] là bao nhiêu?", options: { A: "9", B: "45", C: "22", D: "35" }, answer: "C" },
    { id: 45, question: "Ma trận mặt nạ được biểu diễn dưới đây (1/9 * [[1,1,1],[1,1,1],[1,1,1]]) thuộc loại bộ lọc nào?", options: { A: "Bộ lọc sắc nét trong miền không gian", B: "Bộ lọc sắc nét trong miền tần số", C: "Bộ lọc trung bình", D: "Bộ lọc trung vị" }, answer: "C" },
    { id: 46, question: "Cơ Sở của các phép toán hình thái học là", options: { A: "lý thuyết đồ thị", B: "lý thuyết bản đồ", C: "Sơ đồ logic", D: "lý thuyết tập hợp" }, answer: "D" },
    { id: 47, question: "Phần tử cấu trúc thường là các mảng", options: { A: "hình vuông", B: "hình chữ nhật", C: "hình tròn", D: "hình tam giác" }, answer: "A" },
    { id: 48, question: "Biểu thức nào sau đây biểu diễn toán tử Laplacian?", options: { A: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)-8f(x,y)", B: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)+4f(x,y)", C: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)-f(x,y)", D: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)-4f(x,y)" }, answer: "D" },
    { id: 49, question: "Bộ lọc thông thấp trong miền tần Số được Sử dụng để", options: { A: "tăng cường độ tương phản (contraSt)", B: "làm mờ ảnh (blurring)", C: "thay đổi kích thước ảnh (reSizing)", D: "Sắc nét ảnh (Sharpening)" }, answer: "B" },
    { id: 50, question: "Với phép toán giãn nở, đường biên của ảnh Sẽ", options: { A: "Không đáp án nào đúng", B: "mảnh hơn", C: "Sắc nét hơn", D: "dày hơn" }, answer: "D" },
    { id: 51, question: "Nếu hình bên trái tương ứng với bộ lọc có kích thước ma trận lọc là k_size = 9 thì hình bên phải là kết quả đầu ra của bộ lọc có kích thước là bao nhiêu?", options: { A: "5", B: "7", C: "9", D: "15" }, answer: "D" },
    { id: 52, question: "Các tập hợp trong hình thái học được đề cập đến như là _____trong ảnh", options: { A: "các khung hình", B: "các đối tượng", C: "các điểm ảnh", D: "các tọa độ" }, answer: "B" },
    { id: 53, question: "Bộ lọc làm trơn ảnh còn được gọi là bộ lọc", options: { A: "trung vị", B: "trung bình", C: "thông cao", D: "sắc nét" }, answer: "B" },
    { id: 54, question: "Trong miền không gian, phép toán nào sau đây được thực hiện để làm sắc nét ảnh?", options: { A: "trung vị", B: "vi phân", C: "trung bình", D: "tích phân" }, answer: "B" },
    { id: 55, question: "Phép toán liên quan đến kỹ thuật lọc tuyến tính trong miền không gian là", options: { A: "hàm tương quan", B: "tích chập", C: "cân bằng mức xám", D: "hàm tương quan và tích chập" }, answer: "D" },
    { id: 56, question: "Phép đóng thường được Sử dụng với mục đích", options: { A: "giải nén ảnh", B: "loại bỏ nhiễu", C: "nén ảnh", D: "làm đầy lỗ trống" }, answer: "D" },
    { id: 57, question: "Hình vẽ sau (hình tròn trắng trên nền đen) biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông dải", B: "Bộ lọc chặn dải", C: "Bộ lọc thông thấp", D: "Bộ lọc thông cao" }, answer: "C" },
    { id: 58, question: "Trong kỹ thuật xử lý ảnh, đạo hàm bậc hai của hàm một chiều f(x) được định nghĩa như sau:", options: { A: "∂²f/∂x² = f(x+1) - f(x)", B: "∂²f/∂x² = f(x+1) + f(x)", C: "∂²f/∂x² = f(x+1) + f(x-1) - 2f(x)", D: "∂²f/∂x² = f(x+1) + f(x-1) - 4f(x)" }, answer: "C" },
    { id: 59, question: "FFT là viết tắt của", options: { A: "Frequence Fast Transform", B: "Fast Frequency Transform", C: "Frequence Fourier Transform", D: "Fast Fourier Transform" }, answer: "D" },
    { id: 60, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[-1,-1,-1],[-1,9,-1],[-1,-1,-1]]) là bộ lọc nào?", options: { A: "Bộ lọc Gaussian", B: "Bộ lọc sắc nét", C: "Bộ lọc trung bình", D: "Bộ lọc thông thấp" }, answer: "B" },
    { id: 61, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[0,-1,0],[-1,4,-1],[0,-1,0]]) là bộ lọc nào?", options: { A: "Bộ lọc trung bình", B: "Bộ lọc sắc nét", C: "Bộ lọc Gaussian", D: "Bộ lọc thông thấp" }, answer: "B" },
    { id: 62, question: "Phần tử cấu trúc có gốc tại vị trí", options: { A: "tâm", B: "trên cùng bên trái", C: "trên cùng bên phải", D: "dưới cùng bên trái" }, answer: "A" },
    { id: 63, question: "Đạo hàm bậc hai còn được gọi là", options: { A: "Canny", B: "Gaussian", C: "Laplacian", D: "Không đáp án nào đúng" }, answer: "C" },
    { id: 64, question: "Phép xói mòn thường được Sử dụng để", options: { A: "loại bỏ các đường thẳng", B: "làm mờ ảnh", C: "làm Sắc nét ảnh", D: "Sinh ra các đường thẳng" }, answer: "A" },
    { id: 65, question: "Phép mở được biểu diễn bởi biểu thức nào Sau đây?", options: { A: "A ∘ B", B: "A + B", C: "A - B", D: "A × B" }, answer: "A" },
    { id: 66, question: "Ma trận mặt nạ được biểu diễn dưới đây (1/16 * [[1,2,1],[2,4,2],[1,2,1]]) thuộc loại bộ lọc nào?", options: { A: "Bộ lọc sắc nét trong miền không gian", B: "Bộ lọc trung vị", C: "Bộ lọc trung bình", D: "Bộ lọc sắc nét trong miền tần số" }, answer: "C" },
    { id: 67, question: "Phép xói mòn liên quan đến", options: { A: "phản xạ", B: "giải nén", C: "lọc", D: "nén" }, answer: "D" },
    { id: 68, question: "Kết quả đầu ra của bộ lọc trung vị khi áp dụng vào ma trận ảnh [[10,20,20],[20,15,20],[20,25,100]] là bao nhiêu?", options: { A: "20", B: "25", C: "100", D: "15" }, answer: "A" },
    { id: 69, question: "Kết quả của phép phản xạ của tập B được định nghĩa bởi công thức Sau:", options: { A: "{w|w=-(-b)}", B: "{w|w=b}", C: "{w|w=-b}", D: "{w=-b}" }, answer: "C" },
    { id: 70, question: "Nhược điểm của bộ lọc làm trơn ảnh là", options: { A: "Loại bỏ sự thay đổi đột ngột", B: "làm mờ các điểm ảnh bên trong", C: "Làm sắc nét ảnh", D: "làm mờ biên ảnh" }, answer: "D" },
    { id: 71, question: "Bộ lọc nào phù hợp cho việc loại bỏ nhiễu muối tiêu?", options: { A: "Bộ lọc trung vị", B: "Bộ lọc", C: "Không đáp án nào đúng", D: "Bộ lọc trung bình" }, answer: "A" },
    { id: 72, question: "Ảnh lưu trữ thông tin về sự thay đổi cường độ sáng của các điểm ảnh lân cận, được gọi là gì?", options: { A: "ảnh nhị phân", B: "ảnh đạo hàm", C: "ảnh sắc nét", D: "ảnh mờ" }, answer: "B" }
];

    // --- SCRIPT SECTION ---
    const quizForm = document.getElementById('quiz-form');
    const resultsContainer = document.getElementById('results');
    let score = 0;
    const totalQuestions = quizData.filter(q => q.answer).length;
    const scoredQuestions = []; 

    function renderQuiz() {
        let html = '';
        quizData.forEach((q) => {
            html += `<div class="question-block" id="q-block-${q.id}">`;
            html += `<p class="question-text">${q.id}. ${q.question}</p>`;
            
            if (q.options && Object.keys(q.options).length > 0 && q.answer) {
                html += `<fieldset id="fs-${q.id}">`;
                html += `<div class="options-container">`;
                for (const key in q.options) {
                    html += `<div><input type="radio" name="q${q.id}" id="q${q.id}_${key}" value="${key}"><label for="q${q.id}_${key}">${key}. ${q.options[key]}</label></div>`;
                }
                html += `</div>`;
                html += `</fieldset>`;
            } else {
                 html += `<p><em>(Câu hỏi này không có dữ liệu hoặc định dạng không hợp lệ)</em></p>`;
            }
            html += `<div class="correct-answer" id="ca-${q.id}"></div>`;
            html += `</div>`;
        });
        quizForm.innerHTML = html;
        resultsContainer.innerHTML = `Điểm số: 0 / ${totalQuestions}`;
    }

    function handleAnswerSelection(event) {
        const selectedRadio = event.target;
        if (selectedRadio.tagName !== 'INPUT' || selectedRadio.type !== 'radio') return;

        const questionId = parseInt(selectedRadio.name.substring(1));
        const userAnswer = selectedRadio.value;
        
        const questionData = quizData.find(q => q.id === questionId);
        if (!questionData) return;

        const block = document.getElementById(`q-block-${questionId}`);
        const correctAnswerEl = document.getElementById(`ca-${questionId}`);
        const fieldset = document.getElementById(`fs-${questionId}`);
        
        const isCorrect = userAnswer === questionData.answer;

        if (isCorrect) {
            // Remove incorrect styling from block if present
            block.classList.remove('incorrect');
            
            // Add correct styling
            block.classList.add('correct');
            
            // Update score if it's the first successful attempt for this question
            if (!scoredQuestions.includes(questionId)) {
                score++;
                scoredQuestions.push(questionId);
            }
            resultsContainer.innerHTML = `Điểm số: ${score} / ${totalQuestions}`;

            // Reveal the correct answer
            let correctAnswerText = `Đáp án đúng: <strong>${questionData.answer}. ${questionData.options[questionData.answer]}</strong>`;
            if (questionData.note) {
                correctAnswerText += `<br><span class="note">${questionData.note}</span>`;
            }
            correctAnswerEl.innerHTML = correctAnswerText;
            correctAnswerEl.classList.add('visible');

            // Lock the entire question
            fieldset.disabled = true;

        } else {
            // Mark the block as being attempted and incorrect
            block.classList.add('incorrect');
            
            // Mark the specific selected option div as incorrect
            selectedRadio.parentElement.classList.add('incorrect-option');
            
            // Disable just the wrong radio button
            selectedRadio.disabled = true;
        }
    }

    // --- INITIALIZATION ---
    renderQuiz();
    quizForm.addEventListener('click', handleAnswerSelection);

    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Kiểm Tra Tổng Hợp - Xử Lý Ảnh</title>
    <style>
        :root {
            --primary-color: #8a2be2;
            --correct-color: #28a745;
            --incorrect-color: #dc3545;
            --text-color: #f0f2f5;
            --bg-light: rgba(255, 255, 255, 0.2);
            --bg-very-light: rgba(255, 255, 255, 0.3);
            --border-color: rgba(255, 255, 255, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.7;
            color: var(--text-color);
            /* ** SỬA LỖI Ở ĐÂY: Loại bỏ overflow: hidden và height: 100vh ** */
        }

        .background-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #2c3e50, #4ca1af, #8a2be2, #4a00e0);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            z-index: -1;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #main-container {
            max-width: 900px;
            margin: 20px auto;
            background: var(--bg-light);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            padding: 30px;
        }
        
        h1, h2 {
            text-align: center;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        #setup-container, #final-result-screen {
            text-align: center;
            padding: 40px 0;
        }
        #final-result-screen h2 { font-size: 2.2em; }
        #final-score-text { font-size: 1.6em; font-weight: 600; color: #fff; }
        #redirect-message { font-size: 1em; color: #eee; }
        
        #time-selection {
            margin: 20px 0; display: flex; justify-content: center;
            align-items: center; flex-wrap: wrap; gap: 15px;
        }
        #time-selection h4 { width: 100%; margin-bottom: 10px; font-weight: 500; }
        #time-selection label { cursor: pointer; padding: 5px 10px; }

        .modern-button {
            font-size: 1.1em; padding: 12px 24px; margin: 10px;
            cursor: pointer; border-radius: 50px; border: none;
            font-weight: 600; color: white;
            background: linear-gradient(45deg, var(--primary-color), #4a00e0);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        .modern-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        #shuffle-button.shuffled {
            background: linear-gradient(45deg, #28a745, #218838);
        }
        #submit-button {
            position: fixed; right: 20px; top: 50%;
            transform: translateY(-50%); z-index: 200;
            background: linear-gradient(45deg, #e22b5d, #dc3545);
            display: none;
        }

        #quiz-container { display: none; }
        
        #sticky-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding: 15px;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            margin: -30px -30px 20px -30px; /* Mở rộng ra sát viền container */
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; 
        }
        
        #user-credit {
            position: absolute;
            left: 30px;
            font-weight: 500;
            color: #eee;
            font-size: 0.9em;
        }

        #timer-display {
            text-align: center;
            font-size: 2em;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        #timer-display.ending { color: #ffdddd; }
        
        .question-block {
            margin-bottom: 25px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 12px;
        }
        .question-text { font-weight: 600; margin-bottom: 15px; font-size: 1.2em; }

        .options-container label {
            display: block;
            background: var(--bg-very-light);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .options-container input[type="radio"] { display: none; }
        .options-container label:hover { border-color: var(--border-color); }
        .options-container input[type="radio"]:checked + span { font-weight: 600; }
        .question-block.correct .options-container input[type="radio"]:checked + span { font-weight: 700; }
        .question-block.correct .options-container input[type="radio"]:checked + span::before { content: '✔ '; color: var(--correct-color); }
        .question-block.incorrect .options-container div.incorrect-option label { border-color: var(--incorrect-color); background: rgba(220, 53, 69, 0.3); }
        .question-block.incorrect .options-container div.incorrect-option span::before { content: '✖ '; color: var(--incorrect-color); }
        
        fieldset { border: none; padding: 0; margin: 0; }
        fieldset:disabled label {
            cursor: not-allowed;
            background: rgba(44, 62, 80, 0.5);
            border-color: transparent;
        }
        fieldset:disabled .correct-selection {
            background: rgba(40, 167, 69, 0.5);
            border-color: var(--correct-color);
        }
    </style>
</head>
<body>
    <div class="background-gradient"></div>
    <button id="submit-button" class="modern-button">Nộp bài</button>

    <div id="main-container">
        <div id="setup-container">
            <h1>Bài Kiểm Tra Xử Lý Ảnh</h1>
            <h2>Thiết lập bài làm</h2>
            
            <div id="time-selection">
                <h4>Chọn thời gian làm bài:</h4>
                <div><input type="radio" name="time" value="20" id="t20" checked><label for="t20">20 phút</label></div>
                <div><input type="radio" name="time" value="30" id="t30"><label for="t30">30 phút</label></div>
                <div><input type="radio" name="time" value="40" id="t40"><label for="t40">40 phút</label></div>
                <div><input type="radio" name="time" value="50" id="t50"><label for="t50">50 phút</label></div>
            </div>

            <p>Nhấn "Xáo trộn câu hỏi" nếu bạn muốn thay đổi thứ tự. <br> Sẵn sàng để bắt đầu?</p>
            <button id="shuffle-button" class="modern-button">Xáo trộn câu hỏi</button>
            <button id="start-button" class="modern-button">Bắt đầu</button>
        </div>

        <div id="quiz-container">
            <div id="sticky-header">
                <span id="user-credit">Hung</span>
                <div id="timer-display"></div>
            </div>
            <form id="quiz-form"></form>
        </div>

        <div id="final-result-screen" style="display: none;">
            <h2>Kết quả bài làm</h2>
            <p id="final-score-text"></p>
            <p id="redirect-message"></p>
        </div>
    </div>

    <script>
    const allQuestions = [
        // Bộ đề 1 (72 câu)
        { id: 101, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[0, 1, 0], [1, -4, 1], [0, 1, 0]]) là bộ lọc nào?", options: { A: "Bộ lọc trung bình", B: "Bộ lọc Gaussian", C: "Bộ lọc sắc nét", D: "Bộ lọc thông thấp" }, answer: "C" },
        { id: 102, question: "Bộ lọc nào được sử dụng để tìm điểm sáng nhất trong ảnh?", options: { A: "Bộ lọc trung bình", B: "Không đáp án nào đúng", C: "Bộ lọc cực đại", D: "Bộ lọc trung vị" }, answer: "C" },
        { id: 103, question: "Trong kỹ thuật lọc ảnh, thuật ngữ nào được sử dụng để mô tả phép nhân các điểm ảnh với các hệ số khác nhau trong ma trận lọc?", options: { A: "Lọc trung bình trong miền không gian", B: "Lọc trung bình có trọng số", C: "Không đáp án nào đúng", D: "Lọc trung bình bình phương" }, answer: "B" },
        { id: 104, question: "Đầu ra của bộ lọc làm trơn ảnh, tuyến tính trong miền không gian là", options: { A: "Giá trị trung vị của các điểm ảnh", B: "Giá trị trung bình của các điểm ảnh", C: "Giá trị lớn nhất của các điểm ảnh", D: "Giá trị nhỏ nhất của các điểm ảnh" }, answer: "B" },
        { id: 105, question: "Phần tử cấu trúc SE chạy dịch chuyển trên của ảnh", options: { A: "từng cột", B: "từng đường biên", C: "từng điểm ảnh", D: "từng hàng" }, answer: "C" },
        { id: 106, question: "Trong toán tử hình thái, SE là viết tắt của cụm từ nào Sau đây?", options: { A: "Structuring elements", B: "Software engineer", C: "Structure eliminate", D: "Software engineering" }, answer: "A" },
        { id: 107, question: "Đáp ứng ra của bộ lọc làm trơn, tuyến tính trong miền không gian là", options: { A: "Không đáp án nào đúng", B: "Tổng các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", C: "Tích các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", D: "Giá trị trung bình của các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc" }, answer: "D" },
        { id: 108, question: "Phần tử cấu trúc còn được gọi là", options: { A: "nhiễu (noise)", B: "ảnh con (Sub-image)", C: "các điểm ảnh (pixel)", D: "các đường thẳng (lines)" }, answer: "B" },
        { id: 109, question: "Sự thay đổi cường độ sáng có thể được phát hiện thông qua", options: { A: "phép tích phân", B: "phép toán đạo hàm", C: "phép trừ", D: "phép cộng" }, answer: "B" },
        { id: 110, question: "Bộ lọc thông cao được Sử dụng để", options: { A: "làm Sắc nét ảnh", B: "thay đổi kích thước ảnh", C: "làm mờ ảnh", D: "tăng cường độ tương phản của ảnh" }, answer: "A" },
        { id: 111, question: "Hai toán tử hình thái cơ bản là", options: { A: "phép giãn nở", B: "lý thuyết tập hơn", C: "phép xói mòn", D: "phép xói mòn và giãn nở" }, answer: "D" },
        { id: 112, question: "Trong xử lý ảnh, biến đổi Fourier biến đổi ảnh từ miền không gian sang", options: { A: "miền tần Số", B: "miền không gian", C: "miền Fourier", D: "miền thời gian" }, answer: "A" },
        { id: 113, question: "Bộ lọc nào sau đây được coi như là một dạng của bộ lọc thông thấp?", options: { A: "Tất cả các đáp án đều đúng", B: "Bộ lọc Butterworth", C: "Bộ lọc Gaussian", D: "Bộ lọc lý tưởng" }, answer: "A" },
        { id: 114, question: "Bộ lọc làm trơn ảnh được sử dụng để", options: { A: "Không đáp án nào đúng", B: "loại bỏ nhiễu và làm mờ ảnh", C: "loại bỏ nhiễu", D: "làm mờ ảnh" }, answer: "B" },
        { id: 115, question: "Toán tử nào thực hiện phép xói mòn trước và giãn nở sau?", options: { A: "Phép dịch", B: "Phép mở", C: "Phép đóng", D: "Phép làm mờ ảnh" }, answer: "B" },
        { id: 116, question: "Nếu hình bên trái tương ứng với tần số cắt Do = 15 thì tần số cắt của bộ lọc tương ứng với hình bên phải là bao nhiêu?", options: { A: "Do = 10", B: "Do = 20", C: "Do = 15", D: "Do = 5" }, answer: "D" },
        { id: 117, question: "Trong phép xói mòn, các chi tiết nhỏ hơn phần tử cấu trúc SE Sẽ được", options: { A: "nén", B: "dịch", C: "phản xạ", D: "lọc" }, answer: "D" },
        { id: 118, question: "Thuật ngữ nào không liên quan đến bộ lọc trong miền không gian", options: { A: "cửa sổ trượt (sliding window)", B: "Hàm mật độ xác suất (PDF)", C: "kernel", D: "mặt nạ không gian (spatial mask)" }, answer: "B" },
        { id: 119, question: "Bộ lọc được biểu diễn bởi phương trình: g(x,y) = f(x,y) - ∇²f(x,y) là bộ lọc gì?", options: { A: "Lọc thông thấp", B: "Lọc trung bình", C: "Lọc trung vị", D: "Lọc sắc nét" }, answer: "D" },
        { id: 120, question: "Phép tích chập trong miền không gian được biến đổi thành phép nhân trong miền", options: { A: "thời gian", B: "tần số", C: "không gian", D: "Không đáp án nào đúng" }, answer: "B" },
        { id: 121, question: "Nếu f(x, y) là cường độ sáng của điểm ảnh tại tọa độ (x, y). Đạo hàm bậc nhất theo phương x được tính như sau:", options: { A: "f(x-1,y) + f(x,y)", B: "f(x+1,y) - f(x,y)", C: "f(x-1,y) - f(x+1,y)", D: "f(x,y) - f(x+1,y)" }, answer: "B" },
        { id: 122, question: "Trong bài toán phát hiện biên, chúng ta thường sử dụng", options: { A: "đạo hàm bậc ba", B: "đạo hàm bậc nhất", C: "đạo hàm bậc hai", D: "đạo hàm bậc nhất và bậc hai" }, answer: "D" },
        { id: 123, question: "Phương trình H(u,v) = {1 if D(u,v)<=D0; 0 if D(u,v)>D0} biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông cao lý tưởng", B: "Bộ lọc thông thấp lý tưởng", C: "Bộ lọc thông thấp Butterworth", D: "Bộ lọc thông thấp Gauss" }, answer: "B" },
        { id: 124, question: "Mục tiêu cơ bản của kỹ thuật làm sắc nét ảnh là:", options: { A: "tăng độ sáng của ảnh", B: "giảm độ sáng của ảnh", C: "làm nổi bật các chi tiết trong ảnh", D: "làm nhòe ảnh (blurr)" }, answer: "C" },
        { id: 125, question: "Bình phương của độ lệch chuẩn được gọi là gì?", options: { A: "Phương Sai", B: "Không đáp án nào đúng", C: "Lũy thừa", D: "Nhiễu" }, answer: "A" },
        { id: 126, question: "Bộ lọc thực hiện thay thế giá trị cường độ Sáng của một điểm ảnh bởi giá trị cường độ sáng của điểm ảnh ở vị trí chính giữa của dãy điểm ảnh tương ứng với mặt nạ lọc, được gọi là", options: { A: "bộ lọc trung vị", B: "bộ lọc trung bình hình học", C: "bộ lọc trung bình không gian", D: "bộ lọc trung bình Số học" }, answer: "A" },
        { id: 127, question: "Biên được sinh ra bởi đạo hàm bậc nhất có độ dày như thế nào so với khi sử dụng đạo hàm bậc hai?", options: { A: "Độc lập với nhau", B: "Bằng nhau", C: "Dày hơn", D: "Mảnh hơn" }, answer: "C" },
        { id: 128, question: "Bộ lọc Sobel thường không hoạt động tốt cho bài toán phát hiện", options: { A: "đường chéo", B: "đường biên", C: "đường thẳng đứng", D: "đường nằm ngang" }, answer: "A" },
        { id: 129, question: "Toán tử giãn nở được Sử dụng để", options: { A: "nén ảnh", B: "mở rộng ảnh", C: "giải nén ảnh", D: "dịch ảnh" }, answer: "B" },
        { id: 130, question: "Bộ lọc thông cao cho qua__", options: { A: "tất cả các thành phần", B: "các thành phần có cường độ sáng cao", C: "các thành phần có cường độ sáng thấp", D: "các thành phần có cường độ sáng trung bình" }, answer: "B" },
        { id: 131, question: "Biểu thức H(u,v) = e^(-D²(u,v)/2D₀²) biểu diễn hàm truyền đạt của bộ lọc thông thấp nào?", options: { A: "Bộ lọc Butterworth", B: "Bộ lọc Gauss", C: "Không đáp án nào đúng", D: "Bộ lọc lý tưởng" }, answer: "B" },
        { id: 132, question: "Biểu thức H(u,v) = 1 / (1 + (D(u,v)/D₀)²ⁿ) biểu diễn hàm truyền đạt của bộ lọc thông thấp nào?", options: { A: "Bộ lọc Gauss", B: "Bộ lọc Butterworth", C: "Không đáp án nào đúng", D: "Bộ lọc lý tưởng" }, answer: "B" },
        { id: 133, question: "Giá trị trung bình của các điểm ảnh trong vùng không gian tương ứng với mặt nạ lọc là kết quả đầu ra của bộ lọc", options: { A: "Bộ lọc trung bình", B: "Cả ba đáp án còn lại đều đúng", C: "Bộ lọc thông thấp", D: "Bộ lọc làm trơn ảnh" }, answer: "B" },
        { id: 134, question: "Bộ lọc thay thế giá trị cường độ sáng của điểm ảnh bởi giá trị lớn nhất trong dãy điểm ảnh tương ứng với mặt nạ, được gọi là", options: { A: "bộ lọc trung bình", B: "bộ lọc cực tiểu", C: "bộ lọc trung vị", D: "bộ lọc cực đại" }, answer: "D" },
        { id: 135, question: "Ảnh biên độ Gradient được sử dụng trong bài toán", options: { A: "phát hiện biên", B: "phát hiện đường", C: "phát hiện vùng", D: "phát hiện điểm" }, answer: "A" },
        { id: 136, question: "Trong các phép toán tử hình thái, phần tử cấu trúc SE được coi như", options: { A: "mặt nạ tích chập", B: "mặt nạ tương quan", C: "bộ lọc thông thấp", D: "bộ lọc thông cao" }, answer: "A" },
        { id: 137, question: "Toán tử nào thực hiện phép giãn nở trước và phép xói mòn Sau?", options: { A: "Phép làm mờ ảnh", B: "Phép đóng", C: "Phép dịch", D: "Phép mở" }, answer: "B" },
        { id: 138, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[0, -1, 0], [-1, 5, -1], [0, -1, 0]]) là bộ lọc nào?", options: { A: "Bộ lọc trung bình", B: "Bộ lọc thông thấp", C: "Bộ lọc Gaussian", D: "Bộ lọc sắc nét" }, answer: "D" },
        { id: 139, question: "Với toán tử xói mòn, các đường bao của ảnh được", options: { A: "làm mờ", B: "co lại", C: "mở rộng", D: "Sắc nét" }, answer: "B" },
        { id: 140, question: "Bộ lọc trung bình được sử dụng trong các trường hợp nào sau đây?", options: { A: "Loại bỏ các chi tiết không liên quan trong ảnh", B: "Tất cả các đáp án đều đúng", C: "Loại bỏ nhiễu", D: "Làm mịn các đường biên bị lỗi" }, answer: "B" },
        { id: 141, question: "Hình vẽ sau (hình tròn đen trên nền trắng) biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông thấp", B: "Bộ lọc thông dải", C: "Bộ lọc chặn dải", D: "Bộ lọc thông cao" }, answer: "D" },
        { id: 142, question: "Phép đóng được biểu diễn bởi biểu thức nào Sau đây?", options: { A: "A ∘ B", B: "A - B", C: "A × B", D: "A . B" }, answer: "D" },
        { id: 143, question: "Nhiễu Gauss được hiểu là", options: { A: "nhiễu đen", B: "nhiễu đỏ", C: "nhiễu có phân bố chuẩn", D: "nhiễu trắng" }, answer: "C" },
        { id: 144, question: "Kết quả đầu ra của bộ lọc trung vị khi áp dụng vào ma trận ảnh [[15, 22, 35], [40, 45, 21], [1, 9, 26]] là bao nhiêu?", options: { A: "9", B: "45", C: "22", D: "35" }, answer: "C" },
        { id: 145, question: "Ma trận mặt nạ được biểu diễn dưới đây (1/9 * [[1,1,1],[1,1,1],[1,1,1]]) thuộc loại bộ lọc nào?", options: { A: "Bộ lọc sắc nét trong miền không gian", B: "Bộ lọc sắc nét trong miền tần số", C: "Bộ lọc trung bình", D: "Bộ lọc trung vị" }, answer: "C" },
        { id: 146, question: "Cơ Sở của các phép toán hình thái học là", options: { A: "lý thuyết đồ thị", B: "lý thuyết bản đồ", C: "Sơ đồ logic", D: "lý thuyết tập hợp" }, answer: "D" },
        { id: 147, question: "Phần tử cấu trúc thường là các mảng", options: { A: "hình vuông", B: "hình chữ nhật", C: "hình tròn", D: "hình tam giác" }, answer: "A" },
        { id: 148, question: "Biểu thức nào sau đây biểu diễn toán tử Laplacian?", options: { A: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)-8f(x,y)", B: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)+4f(x,y)", C: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)-f(x,y)", D: "∇²f = f(x-1,y)+f(x+1,y)+f(x,y-1)+f(x,y+1)-4f(x,y)" }, answer: "D" },
        { id: 149, question: "Bộ lọc thông thấp trong miền tần Số được Sử dụng để", options: { A: "tăng cường độ tương phản (contraSt)", B: "làm mờ ảnh (blurring)", C: "thay đổi kích thước ảnh (reSizing)", D: "Sắc nét ảnh (Sharpening)" }, answer: "B" },
        { id: 150, question: "Với phép toán giãn nở, đường biên của ảnh Sẽ", options: { A: "Không đáp án nào đúng", B: "mảnh hơn", C: "Sắc nét hơn", D: "dày hơn" }, answer: "D" },
        { id: 151, question: "Nếu hình bên trái tương ứng với bộ lọc có kích thước ma trận lọc là k_size = 9 thì hình bên phải là kết quả đầu ra của bộ lọc có kích thước là bao nhiêu?", options: { A: "5", B: "7", C: "9", D: "15" }, answer: "D" },
        { id: 152, question: "Các tập hợp trong hình thái học được đề cập đến như là _____trong ảnh", options: { A: "các khung hình", B: "các đối tượng", C: "các điểm ảnh", D: "các tọa độ" }, answer: "B" },
        { id: 153, question: "Bộ lọc làm trơn ảnh còn được gọi là bộ lọc", options: { A: "trung vị", B: "trung bình", C: "thông cao", D: "sắc nét" }, answer: "B" },
        { id: 154, question: "Trong miền không gian, phép toán nào sau đây được thực hiện để làm sắc nét ảnh?", options: { A: "trung vị", B: "vi phân", C: "trung bình", D: "tích phân" }, answer: "B" },
        { id: 155, question: "Phép toán liên quan đến kỹ thuật lọc tuyến tính trong miền không gian là", options: { A: "hàm tương quan", B: "tích chập", C: "cân bằng mức xám", D: "hàm tương quan và tích chập" }, answer: "D" },
        { id: 156, question: "Phép đóng thường được Sử dụng với mục đích", options: { A: "giải nén ảnh", B: "loại bỏ nhiễu", C: "nén ảnh", D: "làm đầy lỗ trống" }, answer: "D" },
        { id: 157, question: "Hình vẽ sau (hình tròn trắng trên nền đen) biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông dải", B: "Bộ lọc chặn dải", C: "Bộ lọc thông thấp", D: "Bộ lọc thông cao" }, answer: "C" },
        { id: 158, question: "Trong kỹ thuật xử lý ảnh, đạo hàm bậc hai của hàm một chiều f(x) được định nghĩa như sau:", options: { A: "∂²f/∂x² = f(x+1) - f(x)", B: "∂²f/∂x² = f(x+1) + f(x)", C: "∂²f/∂x² = f(x+1) + f(x-1) - 2f(x)", D: "∂²f/∂x² = f(x+1) + f(x-1) - 4f(x)" }, answer: "C" },
        { id: 159, question: "FFT là viết tắt của", options: { A: "Frequence Fast Transform", B: "Fast Frequency Transform", C: "Frequence Fourier Transform", D: "Fast Fourier Transform" }, answer: "D" },
        { id: 160, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[-1,-1,-1],[-1,9,-1],[-1,-1,-1]]) là bộ lọc nào?", options: { A: "Bộ lọc Gaussian", B: "Bộ lọc sắc nét", C: "Bộ lọc trung bình", D: "Bộ lọc thông thấp" }, answer: "B" },
        { id: 161, question: "Ma trận lọc được biểu diễn như hình (Ma trận: [[0,-1,0],[-1,4,-1],[0,-1,0]]) là bộ lọc nào?", options: { A: "Bộ lọc trung bình", B: "Bộ lọc sắc nét", C: "Bộ lọc Gaussian", D: "Bộ lọc thông thấp" }, answer: "B" },
        { id: 162, question: "Phần tử cấu trúc có gốc tại vị trí", options: { A: "tâm", B: "trên cùng bên trái", C: "trên cùng bên phải", D: "dưới cùng bên trái" }, answer: "A" },
        { id: 163, question: "Đạo hàm bậc hai còn được gọi là", options: { A: "Canny", B: "Gaussian", C: "Laplacian", D: "Không đáp án nào đúng" }, answer: "C" },
        { id: 164, question: "Phép xói mòn thường được Sử dụng để", options: { A: "loại bỏ các đường thẳng", B: "làm mờ ảnh", C: "làm Sắc nét ảnh", D: "Sinh ra các đường thẳng" }, answer: "A" },
        { id: 165, question: "Phép mở được biểu diễn bởi biểu thức nào Sau đây?", options: { A: "A ∘ B", B: "A + B", C: "A - B", D: "A × B" }, answer: "A" },
        { id: 166, question: "Ma trận mặt nạ được biểu diễn dưới đây (1/16 * [[1,2,1],[2,4,2],[1,2,1]]) thuộc loại bộ lọc nào?", options: { A: "Bộ lọc sắc nét trong miền không gian", B: "Bộ lọc trung vị", C: "Bộ lọc trung bình", D: "Bộ lọc sắc nét trong miền tần số" }, answer: "C" },
        { id: 167, question: "Phép xói mòn liên quan đến", options: { A: "phản xạ", B: "giải nén", C: "lọc", D: "nén" }, answer: "D" },
        { id: 168, question: "Kết quả đầu ra của bộ lọc trung vị khi áp dụng vào ma trận ảnh [[10,20,20],[20,15,20],[20,25,100]] là bao nhiêu?", options: { A: "20", B: "25", C: "100", D: "15" }, answer: "A" },
        { id: 169, question: "Kết quả của phép phản xạ của tập B được định nghĩa bởi công thức Sau:", options: { A: "{w|w=-(-b)}", B: "{w|w=b}", C: "{w|w=-b}", D: "{w=-b}" }, answer: "C" },
        { id: 170, question: "Nhược điểm của bộ lọc làm trơn ảnh là", options: { A: "Loại bỏ sự thay đổi đột ngột", B: "làm mờ các điểm ảnh bên trong", C: "Làm sắc nét ảnh", D: "làm mờ biên ảnh" }, answer: "D" },
        { id: 171, question: "Bộ lọc nào phù hợp cho việc loại bỏ nhiễu muối tiêu?", options: { A: "Bộ lọc trung vị", B: "Bộ lọc", C: "Không đáp án nào đúng", D: "Bộ lọc trung bình" }, answer: "A" },
        { id: 172, question: "Ảnh lưu trữ thông tin về sự thay đổi cường độ sáng của các điểm ảnh lân cận, được gọi là gì?", options: { A: "ảnh nhị phân", B: "ảnh đạo hàm", C: "ảnh sắc nét", D: "ảnh mờ" }, answer: "B" },
        // Bộ đề 2 (81 câu)
        { id: 201, question: "Kỹ thuật nào được đề cập đến trong xử lý ảnh số?", options: { A: "Nâng cao chất lượng ảnh", B: "Biến đổi ảnh", C: "Phân tích ảnh", D: "Tất cả các câu trả lời đều đúng" }, answer: "D" },
        { id: 202, question: "Phát biểu nào sau đây mô tả độ sâu của điểm ảnh?", options: { A: "Số đơn vị (unit) được sử dụng để biểu diễn một điểm ảnh trong không gian RGB", B: "Số mm được sử dụng để biểu diễn một điểm ảnh trong không gian màu RGB", C: "Số byte được sử dụng để biểu diễn một điểm ảnh trong không gian màu RGB", D: "Số bit được sử dụng để biểu diễn một điểm ảnh trong không gian màu RGB" }, answer: "D" },
        { id: 203, question: "Đâu là bước đầu tiên và quan trọng nhất trong kỹ thuật xử lý ảnh số?", options: { A: "Thu nhận ảnh", B: "Phân vùng ảnh", C: "Nâng cao chất lượng ảnh", D: "Khôi phục ảnh" }, answer: "A" },
        { id: 204, question: "Ảnh số được coi là một hàm phụ thuộc vào tọa độ không gian f(x,y) biểu diễn:", options: { A: "chiều cao của ảnh", B: "chiều rộng của ảnh", C: "cường độ sáng của ảnh", D: "độ phân giải của ảnh" }, answer: "C" },
        { id: 205, question: "Điểm ảnh là:", options: { A: "một phần tử của ảnh số", B: "một phần tử của ảnh tương tự", C: "một cụm các phần tử của ảnh số", D: "một cụm các phần tử của ảnh tương tự" }, answer: "A" },
        { id: 206, question: "Ảnh có độ phân giải Full HD có kích thước:", options: { A: "512x512", B: "256x256", C: "1920x1080", D: "1080x1080" }, answer: "C" },
        { id: 207, question: "Mỗi điểm ảnh được tạo nên bởi ba màu cơ bản nào sau đây?", options: { A: "Đỏ, xanh da trời, vàng", B: "Đỏ, xanh lá, xanh da trời", C: "Đỏ, trắng, xanh da trời", D: "Xanh da trời, đen, đỏ" }, answer: "B" },
        { id: 208, question: "Giá trị của mỗi thành phần màu trong điểm ảnh nằm trong khoảng:", options: { A: "[0, 100]", B: "[0, 255]", C: "[1, 100]", D: "[1, 256]" }, answer: "B" },
        { id: 209, question: "Một điểm ảnh có giá trị (R,G,B)=(0,255,0), điểm ảnh đó có màu gì?", options: { A: "Màu đỏ", B: "Màu xanh lá", C: "Màu vàng", D: "Màu xanh da trời" }, answer: "B" },
        { id: 210, question: "Phổ điện từ của ánh sáng nhìn thấy nằm trong khoảng:", options: { A: "400-700nm", B: "600-900nm", C: "400-700pm", D: "600-900pm" }, answer: "A" },
        { id: 211, question: "Hàm nào sau đây biểu diễn biến đổi logarit trong xử lý ảnh?", options: { A: "g(x,y)=c+log[1+f(x,y)]", B: "g(x,y)=c/log[1+f(x,y)]", C: "g(x,y)=c-log[1+f(x,y)]", D: "g(x,y)=c*log[1+f(x,y)]" }, answer: "D" },
        { id: 212, question: "Bộ lọc làm mịn (smooth) được sử dụng để giảm nhiễu và làm mờ biên ảnh.", options: { A: "Đúng", B: "Sai" }, answer: "A" },
        { id: 213, question: "Thuộc tính nào trong không gian màu HSV đặc trưng cho màu gốc (pure color) của điểm ảnh?", options: { A: "Độ bão hòa (Saturation)", B: "Sắc độ (Hue)", C: "Độ sáng (Value)", D: "Cường độ sáng (Intensity)" }, answer: "B" },
        { id: 214, question: "Bốn lân cận theo phương ngang và phương thẳng đứng của điểm ảnh (x, y) có tọa độ là:", options: { A: "(x+1,y+1); (x-1,y-1); (x+1,y-1); (x-1,y+1)", B: "(x+1,y); (x-1,y+1); (x-1,y-1); (x,y-1)", C: "(x,y+1); (x-1,y-1); (x+1,y+1); (x+1,y-1)", D: "(x+1,y); (x-1,y); (x,y+1); (x,y-1)" }, answer: "D" },
        { id: 215, question: "Bốn lân cận theo hai đường chéo của điểm ảnh (x, y) có tọa độ là:", options: { A: "(x+1,y+1); (x-1,y-1); (x+1,y-1); (x-1,y+1)", B: "(x+1,y); (x-1,y+1); (x-1,y-1); (x,y-1)", C: "(x,y+1); (x-1,y-1); (x+1,y-1); (x+1,y+1)", D: "(x+1,y); (x-1,y); (x,y+1); (x,y-1)" }, answer: "A" },
        { id: 216, question: "Cần bao nhiêu bit để biểu diễn một điểm ảnh trong ảnh mức xám (gray-scale)?", options: { A: "8 bit", B: "4 bit", C: "2 bit", D: "24 bit" }, answer: "A" },
        { id: 217, question: "Cần bao nhiêu bit để biểu diễn một điểm ảnh trong ảnh màu?", options: { A: "8 bit", B: "2 bit", C: "24 bit", D: "4 bit" }, answer: "C" },
        { id: 218, question: "Trong ảnh nhị phân, cần bao nhiêu bit để biểu diễn một điểm ảnh?", options: { A: "8 bit", B: "4 bit", C: "2 bit", D: "24 bit" }, answer: "A", note: "Lưu ý: Về lý thuyết, ảnh nhị phân chỉ cần 1 bit. Tuy nhiên, trong các lựa chọn được đưa ra, 8 bit là phương án lưu trữ phổ biến nhất trong thực tế." },
        { id: 219, question: "Trong bước nào sau đây, ảnh được chia thành các vùng nhỏ hơn?", options: { A: "Nâng cao chất lượng ảnh", B: "Thu nhận ảnh", C: "Phân vùng ảnh", D: "Biến đổi Wavelet" }, answer: "C" },
        { id: 220, question: "Tham số nào trong không gian màu HSV thể hiện sự pha loãng màu gốc (pure color) bởi ánh sáng trắng?", options: { A: "Độ bão hòa (Saturation)", B: "Sắc độ (Hue)", C: "Độ sáng (Value)", D: "Không đáp án nào đúng" }, answer: "A" },
        { id: 221, question: "Trong một hệ thống xử lý ảnh, bước nào được thực hiện ngay trước bước xử lý ảnh màu?", options: { A: "Nâng cao chất lượng ảnh", B: "Biến đổi Wavelet và xử lý đa phân giải", C: "Khôi phục ảnh", D: "Thu nhận ảnh" }, answer: "D" },
        { id: 222, question: "Mô hình màu RGB có thể biểu diễn:", options: { A: "hơn 16 triệu màu", B: "hơn 20 triệu màu", C: "hơn 36 triệu màu", D: "hơn 10 triệu màu" }, answer: "A" },
        { id: 223, question: "Công thức nào biểu diễn phép biến đổi từ ảnh màu sang ảnh mức xám?", options: { A: "Gray = 0.2989*R + 0.5870*G + 0.1140*B", B: "Gray = 0.2989*B + 0.5870*G + 0.1140*R", C: "Gray = 0.3989*R + 0.4870*G + 0.1140*B", D: "Gray = 0.2989*R + 0.1140*G + 0.5870*B" }, answer: "A" },
        { id: 224, question: "Lược đồ mức xám h(rk) được định nghĩa như sau (trong đó rk và nk tương ứng là mức xám thứ k và số lượng điểm ảnh có mức xám rk):", options: { A: "h(rk) = nk", B: "h(rk) = nk/rk", C: "h(rk) = nk*rk", D: "h(rk) = rk/nk" }, answer: "A" },
        { id: 225, question: "Lược đồ mức xám được chuẩn hóa theo biểu thức nào sau đây? (nk là số điểm ảnh có mức xám rk và n là tổng số điểm ảnh)", options: { A: "p(rk) = nk/n", B: "p(rk) = nk*n", C: "p(rk) = nk+n", D: "p(rk) = n-nk" }, answer: "A" },
        { id: 226, question: "Tổng các giá trị thành phần của lược đồ mức xám chuẩn hóa bằng:", options: { A: "1", B: "-1", C: "0", D: "100" }, answer: "A" },
        { id: 227, question: "Biểu thức nào biểu diễn phép biến đổi sinh ra ảnh âm bản?", options: { A: "g(x,y) = L-1-f(x,y)", B: "g(x,y) = L-1+f(x,y)", C: "g(x,y) = c*log[1+f(x,y)]", D: "g(x,y) = c*f(x,y)ᵞ" }, answer: "A" },
        { id: 228, question: "Trong công thức của phép biến đổi sinh ra ảnh âm bản, giá trị của tham số L là:", options: { A: "255", B: "256", C: "512", D: "128" }, answer: "B" },
        { id: 229, question: "Công thức nào biểu diễn phép biến đổi hiệu chuẩn Gamma (Gamma Correction)?", options: { A: "g(x,y) = c*f(x,y)ᵞ", B: "g(x,y) = c+f(x,y)ᵞ", C: "g(x,y) = c/f(x,y)ᵞ", D: "g(x,y) = c-f(x,y)ᵞ" }, answer: "A" },
        { id: 230, question: "Mục đích chính của kỹ thuật tăng cường độ tương phản là:", options: { A: "làm ảnh sắc nét, rõ ràng hơn", B: "loại bỏ nhiễu", C: "làm ảnh bị mờ", D: "Không đáp án nào đúng" }, answer: "A" },
        { id: 231, question: "Cho hình vẽ mô tả kỹ thuật tăng cường độ tương phản. Hàm nào sau đây biểu diễn phép biến đổi đó?", options: { A: "T(r)={β(r-a)+sa, γ(r-b)+sb}", B: "T(r)={SH, SL}", C: "T(r)={SH, r}", D: "T(r)={SH, αr}" }, answer: "A", note: "Lưu ý: Câu hỏi này có các lựa chọn không đầy đủ, A là lựa chọn gần đúng nhất về mặt cấu trúc." },
        { id: 232, question: "Đầu ra của bộ lọc làm trơn ảnh, tuyến tính trong miền không gian là:", options: { A: "Giá trị trung vị của các điểm ảnh", B: "Giá trị lớn nhất của các điểm ảnh", C: "Giá trị nhỏ nhất của các điểm ảnh", D: "Giá trị trung bình của các điểm ảnh" }, answer: "D" },
        { id: 233, question: "Nhược điểm của bộ lọc làm trơn ảnh là:", options: { A: "làm mờ biên ảnh", B: "làm mờ các điểm ảnh bên trong", C: "Loại bỏ sự thay đổi đột ngột", D: "Làm sắc nét ảnh" }, answer: "A" },
        { id: 234, question: "Ma trận mặt nạ 1/16 * [[1,2,1],[2,4,2],[1,2,1]] thuộc loại bộ lọc nào?", options: { A: "Bộ lọc sắc nét trong miền không gian", B: "Bộ lọc trung vị", C: "Bộ lọc sắc nét trong miền tần số", D: "Bộ lọc trung bình" }, answer: "D" },
        { id: 235, question: "Ma trận mặt nạ 1/9 * [[1,1,1],[1,1,1],[1,1,1]] thuộc loại bộ lọc nào?", options: { A: "Bộ lọc sắc nét trong miền không gian", B: "Bộ lọc trung vị", C: "Bộ lọc sắc nét trong miền tần số", D: "Bộ lọc trung bình" }, answer: "D" },
        { id: 236, question: "Nếu hình bên trái (mờ hơn) tương ứng với bộ lọc có kích thước 9 thì hình bên phải (nét hơn) có kích thước là bao nhiêu?", options: { A: "5", B: "7", C: "9", D: "15" }, answer: "A" },
        { id: 237, question: "Mục tiêu cơ bản của kỹ thuật làm sắc nét ảnh là:", options: { A: "làm nhòe ảnh (blurr)", B: "làm nổi bật các chi tiết trong ảnh", C: "tăng độ sáng của ảnh", D: "giảm độ sáng của ảnh" }, answer: "B" },
        { id: 238, question: "Trong miền không gian, phép toán nào sau đây được thực hiện để làm sắc nét ảnh?", options: { A: "tích phân", B: "vi phân", C: "trung bình", D: "trung vị" }, answer: "B" },
        { id: 239, question: "Ảnh vi phân làm nổi bật sự thay đổi đột ngột của cường độ sáng và không chú ý tới các điểm ảnh mà tại đó cường độ sáng thay đổi chậm.", options: { A: "Đúng", B: "Sai" }, answer: "A" },
        { id: 240, question: "Đạo hàm bậc nhất của f(x,y) theo phương x được tính như sau:", options: { A: "f(x+1,y)-f(x,y)", B: "f(x,y)-f(x+1,y)", C: "f(x-1,y)-f(x+1,y)", D: "f(x-1,y)+f(x,y)" }, answer: "A" },
        { id: 241, question: "Biên được sinh ra bởi đạo hàm bậc nhất có độ dày như thế nào so với khi sử dụng đạo hàm bậc hai?", options: { A: "Mảnh hơn", B: "Dày hơn", C: "Bằng nhau", D: "Độc lập với nhau" }, answer: "B" },
        { id: 242, question: "Đạo hàm bậc hai của hàm một chiều f(x) được định nghĩa như sau:", options: { A: "∂²f/∂x² = f(x+1) - f(x)", B: "∂²f/∂x² = f(x+1) + f(x-1) - 2f(x)", C: "∂²f/∂x² = f(x+1) + f(x)", D: "∂²f/∂x² = f(x+1) + f(x-1) - 4f(x)" }, answer: "B" },
        { id: 243, question: "Đạo hàm bậc hai còn được gọi là:", options: { A: "Gaussian", B: "Laplacian", C: "Canny", D: "Không đáp án nào đúng" }, answer: "B" },
        { id: 244, question: "Bộ lọc làm trơn ảnh được sử dụng để:", options: { A: "làm mờ ảnh", B: "loại bỏ nhiễu", C: "loại bỏ nhiễu và làm mờ ảnh", D: "Không đáp án nào đúng" }, answer: "B" },
        { id: 245, question: "Đáp ứng ra của bộ lọc làm trơn, tuyến tính trong miền không gian là:", options: { A: "Tổng các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", B: "Tích các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", C: "Giá trị trung bình của các điểm ảnh nằm trong vùng không gian tương ứng với mặt nạ lọc", D: "Không đáp án nào đúng" }, answer: "A" },
        { id: 246, question: "Giá trị trung bình của các điểm ảnh trong vùng không gian tương ứng với mặt nạ lọc là kết quả đầu ra của bộ lọc:", options: { A: "Bộ lọc trung bình", B: "Bộ lọc làm trơn ảnh", C: "Bộ lọc thông thấp", D: "Cả ba đáp án còn lại đều đúng" }, answer: "D" },
        { id: 247, question: "Biểu thức nào sau đây biểu diễn toán tử Laplacian?", options: { A: "∇²f = f(x-1,y) + f(x+1,y) + f(x,y-1) + f(x,y+1) - 4f(x,y)", B: "∇²f = f(x-1,y) + f(x+1,y) + f(x,y-1) + f(x,y+1) - f(x,y)", C: "∇²f = f(x-1,y) + f(x+1,y) + f(x,y-1) + f(x,y+1) - 8f(x,y)", D: "∇²f = f(x-1,y) + f(x+1,y) + f(x,y-1) + f(x,y+1) + 4f(x,y)" }, answer: "A" },
        { id: 248, question: "Ma trận lọc [[0,1,0],[1,-4,1],[0,1,0]] là bộ lọc nào?", options: { A: "Bộ lọc sắc nét", B: "Bộ lọc thông thấp", C: "Bộ lọc trung bình", D: "Bộ lọc Gaussian" }, answer: "A" },
        { id: 249, question: "Ma trận lọc [[0,-1,0],[-1,4,-1],[0,-1,0]] là bộ lọc nào?", options: { A: "Bộ lọc sắc nét", B: "Bộ lọc thông thấp", C: "Bộ lọc trung bình", D: "Bộ lọc Gaussian" }, answer: "A" },
        { id: 250, question: "Bộ lọc được biểu diễn bởi phương trình g(x,y) = f(x,y) - ∇²f(x,y) là bộ lọc gì?", options: { A: "Lọc trung bình", B: "Lọc trung vị", C: "Lọc sắc nét", D: "Lọc thông thấp" }, answer: "C" },
        { id: 251, question: "Ma trận lọc [[0,-1,0],[-1,5,-1],[0,-1,0]] là bộ lọc nào?", options: { A: "Bộ lọc sắc nét", B: "Bộ lọc thông thấp", C: "Bộ lọc trung bình", D: "Bộ lọc Gaussian" }, answer: "A" },
        { id: 252, question: "Ma trận lọc [[-1,-1,-1],[-1,9,-1],[-1,-1,-1]] là bộ lọc nào?", options: { A: "Bộ lọc sắc nét", B: "Bộ lọc thông thấp", C: "Bộ lọc trung bình", D: "Bộ lọc Gaussian" }, answer: "A" },
        { id: 253, question: "Hình vẽ một hình tròn trắng ở trung tâm trên nền đen trong miền tần số biểu diễn bộ lọc nào?", options: { A: "Bộ lọc thông thấp", B: "Bộ lọc thông cao" }, answer: "A" },
        { id: 254, question: "Hình vẽ một hình tròn đen ở trung tâm trên nền trắng trong miền tần số biểu diễn bộ lọc nào?", options: { A: "Bộ lọc thông thấp", B: "Bộ lọc thông cao" }, answer: "B" },
        { id: 255, question: "Phương trình D(u,v) = [(u-M/2)² + (v-N/2)²]¹/² biểu diễn bộ lọc nào trong miền tần số?", options: { A: "Bộ lọc thông thấp lý tưởng", B: "Bộ lọc thông cao lý tưởng", C: "Bộ lọc thông thấp Butterworth", D: "Bộ lọc thông thấp Gauss" }, answer: "D", note: "Lưu ý: Câu hỏi này không chính xác. Đây là công thức tính khoảng cách, không phải là một bộ lọc hoàn chỉnh." },
        { id: 256, question: "Phép toán logic nào cho ra kết quả là một mẫu bàn cờ (checkerboard) từ hai ảnh vuông?", options: { A: "AND", B: "OR", C: "XOR", D: "Không có đáp án nào đúng" }, answer: "C" },
        { id: 257, question: "Theo toán tử tập hợp, kết quả của phép toán Giao {A} ∩ {B} là hình nào?", options: { A: "Hình (1)", B: "Hình (2)", C: "Hình (3)", D: "Hình (4)" }, answer: "A" },
        { id: 258, question: "Theo toán tử tập hợp, kết quả của phép toán Hợp {A} U {B} là hình nào?", options: { A: "Hình (1)", B: "Hình (2)", C: "Hình (3)", D: "Hình (4)" }, answer: "C" },
        { id: 259, question: "Theo toán tử tập hợp, kết quả của phép toán Hiệu {A} - {B} là hình nào?", options: { A: "Hình (1)", B: "Hình (2)", C: "Hình (3)", D: "Hình (4)" }, answer: "B" },
        { id: 260, question: "Bộ lọc Sobel không tốt cho việc phát hiện nào sau đây?", options: { A: "đường ngang", B: "đường thẳng đứng", C: "đường chéo", D: "các cạnh" }, answer: "C" },
        { id: 261, question: "Trung vị của dãy: {15, 22, 35, 40, 45, 21, 1, 9, 26, 29, 19} là:", options: { A: "21", B: "45", C: "1", D: "22" }, answer: "D" },
        { id: 262, question: "Biến đổi Hough của đường thẳng đi qua 3 điểm thẳng hàng tại x=0.5 là:", options: { A: "Điểm X(ρ, θ) = X(1, pi/2)", B: "Điểm X(ρ, θ) = X(0.5, pi/2)", C: "Điểm X(ρ, θ) = X(0.5, pi)", D: "Điểm X(ρ, θ) = X(0.5, 0)" }, answer: "D" },
        { id: 263, question: "Cách nào sau đây là dùng để lưu hình ảnh bằng OpenCV?", options: { A: "cv2.imwrite(filename, image)", B: "cv2.save(filename, image)", C: "cv2.write(filename, image)", D: "cv2.imsave(filename, image)" }, answer: "A" },
        { id: 264, question: "Đoạn mã d = img.shape trả về giá trị gì?", options: { A: "Kích thước của hình ảnh", B: "Phạm vi giá trị pixel trong hình ảnh", C: "Số pixel trong ảnh", D: "Lỗi cú pháp" }, answer: "A" },
        { id: 265, question: "Hàm được sử dụng để đọc video từ webcam là gì?", options: { A: "cv2.VideoCapture(0)", B: "cv2.VideoCapture('video.mp4')", C: "cv2.VideoCapture('image.jpg')", D: "cv2.VideoCapture('webcam_location')" }, answer: "A" },
        { id: 266, question: "Đoạn chương trình đọc video dùng `while True` sẽ lỗi khi kết thúc vì:", options: { A: "Lỗi hàm read()", B: "Lỗi hàm imshow()", C: "Không có điều kiện thoát vòng lặp", D: "Lỗi giải phóng video" }, answer: "C", note: "Vòng lặp không có điều kiện thoát, khiến `frame` trở thành `None` và `imshow` báo lỗi." },
        { id: 267, question: "Hàm trong OpenCV-Python cho phép đọc hình ảnh từ một nguồn là gì?", options: { A: "cv2.imshow('Label', 'some_sources')", B: "cv2.VideoCapture('some_sources')", C: "cv2.imread('some_sources')", D: "cv2.imread()" }, answer: "C" },
        { id: 268, question: "Ảnh có chiều rộng 700, cao 550, 3 kênh sẽ có dạng mảng NumPy là:", options: { A: "(550, 700, 3)", B: "(3, 550, 700)", C: "(700, 550, 3)", D: "(3, 700, 550)" }, answer: "A" },
        { id: 269, question: "OpenCV lưu trữ các pixel RGB theo thứ tự nào?", options: { A: "GBR", B: "RGB", C: "BRG", D: "BGR" }, answer: "D" },
        { id: 270, question: "Để trích xuất vùng chữ nhật từ x=9, y=47 đến x=96, y=96. Dòng mã chính xác là:", options: { A: "Crop = image[9:97, 47:96]", B: "Crop = image[47:96, 9:97]", C: "Crop = image[47:97, 9:97]", D: "Crop = image[97:96, 9:47]" }, answer: "C" },
        { id: 271, question: "Đoạn code `img1 = 255 - img` thực hiện nhiệm vụ gì?", options: { A: "Chuyển ảnh màu RGB sang ảnh mức xám", B: "Chuyển ảnh màu RGB sang ảnh âm bản.", C: "Chuyển ảnh màu RGB sang ảnh trắng đen", D: "Chuyển ảnh mức xám sang ảnh trắng đen." }, answer: "B" },
        { id: 272, question: "Hình ảnh biên (edge image) là kết quả của việc áp dụng bộ lọc gì?", options: { A: "Lọc thông thấp", B: "Lọc thông cao", C: "Lọc thông dải", D: "Lọc trung bình" }, answer: "B" },
        { id: 273, question: "Đoạn chương trình thêm nhiễu 's&p' và sau đó dùng `cv2.medianBlur` có mục đích lọc nhiễu bằng bộ lọc gì?", options: { A: "Lọc thông thấp", B: "Lọc thông cao", C: "Lọc thông dải", D: "Lọc trung bình" }, answer: "D", note: "Lưu ý: Không có đáp án chính xác. Code dùng 'Bộ lọc trung vị' (Median Filter)." },
        { id: 274, question: "Hàm OpenCV nào sau đây có thể được sử dụng để tạo ngưỡng cho một hình ảnh?", options: { A: "cv2.threshold()", B: "cv2.thresh()", C: "cv2.Thresh()", D: "cv2.Threshold()" }, answer: "A" },
        { id: 275, question: "Phương án nào mô tả đúng dòng lệnh `cv2.waitKey(0)`?", options: { A: "cv2.waitKey(0) cho phép người dùng xem hình ảnh cho đến khi nhấn bất kỳ phím nào.", B: "cv2.waitKey(0) cho phép người dùng xem hình ảnh trong 500 mili giây.", C: "cv2.waitKey(0) đóng hình ảnh ngay sau khi được hiển thị.", D: "Cả A và B." }, answer: "A" },
        { id: 276, question: "Đoạn chương trình `if cv2.waitKey(1) & 0xFF == ord('q'): break` sẽ kết thúc khi nào?", options: { A: "Nếu bạn nhấn phím ‘q’ và đợi 1 phút", B: "Nếu bạn nhấn phím ‘q’", C: "Nếu bạn nhấn phím bất kỳ", D: "Chương trình chờ 1 giây rồi kết thúc" }, answer: "B" },
        { id: 277, question: "Tham số `img` trong hàm `cv2.Canny(img,...)` là gì?", options: { A: "Ảnh màu RGB", B: "Ảnh nhị phân", C: "Ảnh mức xám" }, answer: "C" },
        { id: 278, question: "Để khởi tạo ma trận bộ lọc trung bình 3x3, ta cần thực hiện lệnh như thế nào?", options: { A: "H = np.ones((3,3), np.float32)/9", B: "H = np.ones((3,3), np.int32)/9", C: "H = np.zeros((3,3), np.float32)/9", D: "H = np.ones((3,3), np.int)/9" }, answer: "A" },
        { id: 279, question: "Đoạn chương trình `img = cv2.imread('hinhanh')` bị lỗi có thể do:", options: { A: "Lỗi cv2.waitKey(0)", B: "Lỗi cv2.imread", C: "Lỗi 'hinhanh' không xác định", D: "Lỗi cv2.imshow" }, answer: "C" },
        { id: 280, question: "Đoạn chương trình vẽ các hình nhưng không nhìn thấy hình tròn, tại sao?", options: { A: "Không nhìn thấy đường thẳng trong ảnh.", B: "Không nhìn thấy hình tròn trong ảnh.", C: "Không nhìn thấy hình chữ nhật trong ảnh.", D: "Không nhìn thấy tất cả." }, answer: "B", note: "Phân tích code: Nền xanh (255,0,0), hình tròn cũng màu xanh (255,0,0)." },
        { id: 281, question: "Đoạn chương trình vẽ các hình nhưng không nhìn thấy hình chữ nhật, tại sao?", options: { A: "Không nhìn thấy đường thẳng trong ảnh.", B: "Không nhìn thấy hình tròn trong ảnh.", C: "Không nhìn thấy hình chữ nhật trong ảnh.", D: "Không nhìn thấy tất cả." }, answer: "C", note: "Phân tích code: Nền đỏ (0,0,255), hình chữ nhật cũng màu đỏ (0,0,255)." }
    ];

    const uniqueQuestions = new Map();
    allQuestions.forEach(q => {
        const trimmedQuestion = q.question.trim().replace(/\s+/g, ' ');
        if (!uniqueQuestions.has(trimmedQuestion)) {
            uniqueQuestions.set(trimmedQuestion, q);
        }
    });

    const quizData = Array.from(uniqueQuestions.values());
    quizData.forEach((q, index) => {
        q.id = index + 1;
    });

    const quizForm = document.getElementById('quiz-form');
    const timerDisplay = document.getElementById('timer-display');
    const setupContainer = document.getElementById('setup-container');
    const quizContainer = document.getElementById('quiz-container');
    const startButton = document.getElementById('start-button');
    const shuffleButton = document.getElementById('shuffle-button');
    const submitButton = document.getElementById('submit-button');
    const finalResultScreen = document.getElementById('final-result-screen');
    const mainContainer = document.getElementById('main-container');
    
    let score = 0;
    let timerInterval;
    const incorrectlyAttemptedQuestions = []; 

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    shuffleButton.addEventListener('click', () => {
        shuffleArray(quizData);
        shuffleButton.textContent = 'Đã xáo trộn!';
        shuffleButton.classList.add('shuffled');
        shuffleButton.disabled = true;
    });

    startButton.addEventListener('click', () => {
        setupContainer.style.display = 'none';
        quizContainer.style.display = 'flex'; // Dùng flex để header và content-wrapper hoạt động tốt
        submitButton.style.display = 'block';
        
        const selectedTimeInput = document.querySelector('input[name="time"]:checked');
        const durationInMinutes = selectedTimeInput ? parseInt(selectedTimeInput.value) : 20;
        startTimer(durationInMinutes);

        renderQuiz();
    });

    submitButton.addEventListener('click', () => {
        if (confirm('Bạn có chắc chắn muốn nộp bài không?')) {
            endQuiz();
        }
    });

    function renderQuiz() {
        let html = '';
        quizData.forEach((q, index) => {
            const correctAnswerText = q.options[q.answer];
            let optionsArray = Object.keys(q.options).map(key => ({ key, text: q.options[key] }));
            shuffleArray(optionsArray);

            const shuffledOptions = {};
            let newAnswerKey = '';
            const newKeys = ['A', 'B', 'C', 'D', 'E'];

            optionsArray.forEach((option, i) => {
                const currentKey = newKeys[i];
                shuffledOptions[currentKey] = option.text;
                if (option.text === correctAnswerText) {
                    newAnswerKey = currentKey;
                }
            });
            
            q.shuffledAnswer = newAnswerKey;

            html += `<div class="question-block" id="q-block-${q.id}">`;
            html += `<p class="question-text">${index + 1}. ${q.question}</p>`;
            
            if (q.image) {
                html += `<div style="text-align: center; margin-bottom: 15px;">
                            <img src="${q.image}" alt="Hình ảnh cho câu hỏi ${index + 1}" style="max-width: 100%; max-height: 250px; border-radius: 8px;">
                         </div>`;
            }

            html += `<fieldset id="fs-${q.id}">`;
            html += `<div class="options-container">`;
            for (const key in shuffledOptions) {
                // Thay đổi cấu trúc để label bao bọc input
                html += `<div>
                            <label>
                                <input type="radio" name="q${q.id}" value="${key}">
                                <span>${key}. ${shuffledOptions[key]}</span>
                            </label>
                         </div>`;
            }
            html += `</div>`;
            html += `</fieldset>`;
            html += `</div>`;
        });
        quizForm.innerHTML = html;
    }

    function handleAnswerSelection(event) {
        const selectedRadio = event.target;
        if (selectedRadio.tagName !== 'INPUT' || selectedRadio.type !== 'radio') return;

        const questionId = parseInt(selectedRadio.name.substring(1));
        const userAnswer = selectedRadio.value;
        
        const questionData = quizData.find(q => q.id === questionId);
        if (!questionData || questionData.answeredCorrectly) {
            return;
        }

        const block = document.getElementById(`q-block-${questionId}`);
        block.classList.remove('correct', 'incorrect');
        Array.from(block.querySelectorAll('.options-container div')).forEach(div => {
            div.classList.remove('incorrect-option', 'correct-selection');
        });

        const isCorrect = userAnswer === questionData.shuffledAnswer;
        const selectedLabelDiv = selectedRadio.closest('div');

        if (isCorrect) {
            block.classList.add('correct');
            selectedLabelDiv.classList.add('correct-selection');
            document.getElementById(`fs-${questionId}`).disabled = true;
            questionData.answeredCorrectly = true;

            if (!incorrectlyAttemptedQuestions.includes(questionId)) {
                score++;
            }
        } else {
            block.classList.add('incorrect');
            selectedLabelDiv.classList.add('incorrect-option');

            if (!incorrectlyAttemptedQuestions.includes(questionId)) {
                incorrectlyAttemptedQuestions.push(questionId);
            }
        }
    }

    function startTimer(minutes) {
        let duration = minutes * 60;
        timerInterval = setInterval(() => {
            const mins = Math.floor(duration / 60);
            let secs = duration % 60;
            secs = secs < 10 ? '0' + secs : secs;

            timerDisplay.textContent = `${mins}:${secs}`;
            
            if (duration < 60 && !timerDisplay.classList.contains('ending')) {
                timerDisplay.classList.add('ending');
            }

            if (--duration < 0) {
                endQuiz(true);
            }
        }, 1000);
    }

    function endQuiz(isTimeOut = false) {
        clearInterval(timerInterval);
        if (isTimeOut) {
            timerDisplay.textContent = "HẾT GIỜ!";
            alert("Đã hết giờ làm bài!");
        }
        
        mainContainer.innerHTML = ''; // Xóa nội dung cũ
        mainContainer.appendChild(finalResultScreen); // Chỉ hiển thị màn hình kết quả

        const totalQuestions = quizData.length;
        document.getElementById('final-score-text').textContent = `Bạn đã đạt: ${score} / ${totalQuestions} điểm`;
        finalResultScreen.style.display = 'block';

        let countdown = 5;
        const redirectMessage = document.getElementById('redirect-message');
        redirectMessage.textContent = `Trang sẽ tải lại sau ${countdown} giây...`;

        const countdownInterval = setInterval(() => {
            countdown--;
            redirectMessage.textContent = `Trang sẽ tải lại sau ${countdown} giây...`;
            if (countdown <= 0) {
                clearInterval(countdownInterval);
            }
        }, 1000);

        setTimeout(() => {
            location.reload();
        }, 5000);
    }

    quizForm.addEventListener('click', handleAnswerSelection);
    </script>
</body>
</html>

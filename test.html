<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc Nghiệm Kỹ Thuật Thi Công Cầu Đường</title>
    <style>
        :root {
            --primary-color: #007bff;
            --correct-color: #28a745;
            --incorrect-color: #dc3545;
            --text-color: #212529;
            --light-text-color: #6c757d;
            --bg-color: #f8f9fa;
            --container-bg-color: #ffffff;
            --border-color: #dee2e6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            padding-top: 80px;
        }

        #main-container {
            max-width: 900px;
            margin: 20px auto;
            background-color: var(--container-bg-color);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        #content-padding { padding: 30px; }

        h1, h2 { text-align: center; color: #0056b3; }
        h1 { margin-bottom: 10px; }
        h2 { margin-bottom: 20px; color: var(--text-color); font-size: 1.5em; }

        /* Setup Screen Styles */
        #setup-container, #final-result-screen, #leaderboard-screen {
            text-align: center;
            padding: 20px 0;
        }

        /* Name Input Styles */
        .input-group {
            margin-bottom: 20px;
            text-align: center;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        #username-input {
            padding: 10px 15px;
            font-size: 1.1em;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            width: 80%;
            max-width: 300px;
            transition: border-color 0.3s;
        }
        #username-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* Result & Leaderboard Styles */
        #final-score-text { font-size: 1.8em; font-weight: 700; color: var(--correct-color); margin: 20px 0; }
        
        table.leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        table.leaderboard-table th, table.leaderboard-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        table.leaderboard-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        table.leaderboard-table tr:nth-child(even) { background-color: #f2f2f2; }
        table.leaderboard-table tr:hover { background-color: #e9ecef; }
        .rank-1 { color: gold; font-weight: bold; }
        .rank-2 { color: silver; font-weight: bold; }
        .rank-3 { color: #cd7f32; font-weight: bold; }

        /* Time Selection */
        #time-selection {
            margin: 20px 0; display: flex; justify-content: center;
            align-items: center; flex-wrap: wrap; gap: 15px;
        }
        #time-selection h4 { width: 100%; margin-bottom: 10px; font-weight: 500; }
        #time-selection label { cursor: pointer; padding: 5px 10px; }

        /* Buttons */
        .modern-button {
            font-size: 1.1em; padding: 12px 24px; margin: 10px;
            cursor: pointer; border-radius: 8px; border: none;
            font-weight: 600; color: white;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .modern-button:hover { opacity: 0.9; transform: translateY(-2px); }
        .modern-button:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }
        
        #start-button { background-color: var(--primary-color); }
        #shuffle-button { background-color: #6c757d; }
        #shuffle-button.shuffled { background-color: var(--correct-color); }
        .btn-restart { background-color: #17a2b8; }
        .btn-leaderboard { background-color: #ffc107; color: #212529; }
        
        #submit-button {
            position: fixed; right: 20px; bottom: 20px;
            z-index: 200; background-color: var(--incorrect-color);
            display: none; border-radius: 50%;
            width: 60px; height: 60px; padding: 0; font-size: 1em;
        }
        
        #quiz-container { display: none; }
        
        /* Sticky Header */
        #sticky-header {
            position: fixed; top: 0; left: 0; width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            padding: 15px 20px; z-index: 100;
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        #user-credit { font-weight: 600; color: var(--light-text-color); font-size: 1.1em; }
        #timer-display { font-size: 1.8em; font-weight: 700; color: var(--primary-color); }
        #timer-display.ending { color: var(--incorrect-color); }
        
        /* Questions */
        .question-block {
            margin-bottom: 25px; padding: 25px; border-radius: 12px;
            background-color: #ffffff; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid transparent;
        }
        .question-text { font-weight: 600; margin-bottom: 20px; font-size: 1.15em; }

        .options-container label {
            display: block; background: var(--bg-color);
            padding: 15px; margin-bottom: 10px; border-radius: 8px;
            border: 2px solid var(--bg-color); cursor: pointer;
            transition: all 0.2s ease;
        }
        .options-container input[type="radio"] { display: none; }
        .options-container label:hover { border-color: var(--primary-color); }
        
        .question-block.correct .options-container .correct-selection label {
            border-color: var(--correct-color); background-color: #e9f7ef;
            color: #1d643b; font-weight: 600;
        }
        .question-block.correct .options-container .correct-selection span::before { content: '✔ '; }
        
        .question-block.incorrect .options-container div.incorrect-option label {
             border-color: var(--incorrect-color); background-color: #fbebed;
        }
        
        fieldset { border: none; padding: 0; margin: 0; }
        fieldset:disabled label { cursor: not-allowed; opacity: 0.8; }

        @media (max-width: 768px) {
            body { padding-top: 70px; }
            #main-container { margin: 0; border-radius: 0; }
            #content-padding { padding: 15px; }
            h1 { font-size: 1.5em; }
            #sticky-header { padding: 10px 15px; }
            #timer-display { font-size: 1.5em; }
            #username-input { width: 100%; }
        }
    </style>
</head>
<body>
    <div id="sticky-header" style="display:none;">
        <span id="user-credit">Người dùng</span>
        <div id="timer-display"></div>
    </div>

    <button id="submit-button" class="modern-button">Nộp</button>

    <div id="main-container">
        <div id="content-padding">
            <div id="setup-container">
                <h1>Kỹ Thuật Thi Công</h1>
                <h2>Thiết lập bài làm (Nền & Mặt Đường)</h2>
                
                <div class="input-group">
                    <label for="username-input">Nhập họ và tên của bạn:</label>
                    <input type="text" id="username-input" placeholder="Ví dụ: Nguyễn Văn A">
                </div>
                
                <div id="time-selection">
                    <h4>Chọn thời gian làm bài:</h4>
                    <div><input type="radio" name="time" value="30" id="t30" checked><label for="t30">30 phút</label></div>
                    <div><input type="radio" name="time" value="60" id="t60"><label for="t60">60 phút</label></div>
                    <div><input type="radio" name="time" value="90" id="t90"><label for="t90">90 phút</label></div>
                </div>

                <p>Nhấn "Xáo trộn câu hỏi" nếu bạn muốn thay đổi thứ tự.<br>Sẵn sàng để bắt đầu?</p>
                <button id="shuffle-button" class="modern-button">Xáo trộn câu hỏi</button>
                <button id="start-button" class="modern-button">Bắt đầu làm bài</button>
                <br>
                <button class="modern-button btn-leaderboard" onclick="showLeaderboard(true)">Xem Bảng Xếp Hạng Online</button>
            </div>

            <div id="quiz-container">
                <form id="quiz-form"></form>
            </div>

            <div id="final-result-screen" style="display: none;">
                <h2>Kết quả bài làm</h2>
                <p id="final-score-text"></p>
                
                <div>
                    <button class="modern-button btn-leaderboard" id="view-leaderboard-btn">Xem Bảng Xếp Hạng</button>
                    <button class="modern-button btn-restart" onclick="location.reload()">Làm bài lại</button>
                </div>
            </div>

            <div id="leaderboard-screen" style="display: none;">
                <h2>Bảng Xếp Hạng (Trực Tuyến)</h2>
                <div style="overflow-x: auto;">
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th style="width: 10%;">Hạng</th>
                                <th style="width: 40%;">Tên</th>
                                <th style="width: 20%;">Điểm số</th>
                                <th style="width: 30%;">Thời gian</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <tr><td colspan="4" style="text-align:center;">Đang tải dữ liệu từ server...</td></tr>
                        </tbody>
                    </table>
                </div>
                <button class="modern-button btn-restart" onclick="location.reload()">Quay lại trang chủ</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import các hàm cần thiết từ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // Cấu hình Firebase của bạn
        const firebaseConfig = {
            apiKey: "AIzaSyBKIkzONHTQZZcmQIkzG9avMM8kwG8Yzck",
            databaseURL: "https://quanlychamcong-9dacd-default-rtdb.firebaseio.com"
        };

        // Khởi tạo Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- CÁC BIẾN & LOGIC CHÍNH ---
        
        // Dữ liệu câu hỏi mới trích xuất từ tài liệu (Chương 1 - Chương 6)
        // LƯU Ý: Do tài liệu gốc không hiển thị màu vàng trong text, đáp án mặc định là A hoặc được suy luận logic.
        const allQuestions = [
            { id: 1, question: "Nền đường bao gồm:", options: { A: "Toàn bộ phần đào, đắp vật liệu trong phạm vi mặt cắt ngang thiết kế (thi công) của đường ô tô, bao gồm phần thuộc kết cấu áo đường", B: "Toàn bộ phần đào, đắp vật liệu trong phạm vi mặt cắt ngang thiết kế (thi công) của đường ô tô, trừ phần thuộc kết cấu áo đường", C: "Toàn bộ phần đắp vật liệu trong phạm vi mặt cắt ngang thiết kế (thi công) của đường ô tô, trừ phần thuộc kết cấu áo đường", D: "Toàn bộ phần đào đất trong phạm vi mặt cắt ngang thiết kế (thi công) của đường ô tô, trừ phần thuộc kết cấu áo đường" }, answer: "B" },
            { id: 2, question: "Hãy nêu tác dụng của nên đường?", options: { A: "Khắc phục địa hình thiên nhiên nhằm tạo nên một dải đất đủ rộng dọc theo tuyến đường...", B: "Làm cơ sở cho áo đường: lớp phía trên của nền đường cùng với áo đường chịu tác dụng của tải trọng xe cộ...", C: "Cả A và B đều đúng", D: "Cả A và B đều sai" }, answer: "C" },
            { id: 3, question: "Nền đường phải luôn đảm bảo ổn định về mặt cường độ, nghĩa là?", options: { A: "Cường độ của mặt đường không được thay đổi theo thời gian...", B: "Cường độ của nền đường thay đổi theo thời gian...", C: "Cường độ của nền đường không được thay đổi theo thời gian, theo điều kiện khí hậu, thời tiết một cách bất lợi", D: "Cường độ của nền đường thay đổi theo thời gian, theo điều kiện khí hậu, thời tiết một cách thuận lợi" }, answer: "C" },
            { id: 4, question: "Các yếu tố ảnh hưởng đến cường độ của nên đường gồm:", options: { A: "Vật liệu xây dựng nền đường; Công nghệ thi công nền mặt đường...", B: "Vật liệu xây dựng nền đường; Chất lượng thi công nền đường...", C: "Cả A và B đúng", D: "Cả A và B sai" }, answer: "C" },
            { id: 5, question: "Các yêu cầu đối với thi công nên đường:", options: { A: "Đảm bảo nền đường có tính năng sử dụng tốt; Chọn phương pháp thi công và thiết bị thi công hợp lý", B: "Tuân thủ chặt chẽ quy trình kỹ thuật thi công và tiến độ thi công", C: "Cả A và B đúng", D: "Cả A và B sai" }, answer: "C" },
            { id: 6, question: "Trình tự và nội dung thi công nên đường:", options: { A: "Công tác chuẩn bị trước khi thi công; Công tác chính; và công tác hoàn thiện", B: "Công tác chuẩn bị trước khi thi công; Công tác chính; và công tác phụ", C: "Công tác chuẩn bị trước khi thi công; Công tác chuẩn bị về mặt kỹ thuật; và công tác hoàn thiện", D: "Cả A, B, C đúng" }, answer: "A" },
            { id: 7, question: "Các phương pháp thi công nên đường bao gồm:", options: { A: "Thi công bằng thủ công; Thi công bằng máy; Thi công bằng nổ phá đất đá nền đường đào", B: "Thi công bằng thủ công đơn giản; Thi công bằng máy cơ giới hiện đại; Thi công bằng sức nước làm cho đất xói lở", C: "Thi công bằng thủ công; Thi công bằng máy; Thi công bằng nổ phá; Thi công bằng sức nước", D: "Thi công bằng kỹ nghệ; Thi công bằng máy; Thi công bằng nổ phá; Thi công bằng đào đá" }, answer: "C" },
            { id: 8, question: "Phát biểu nào sau đây không đúng về các phương pháp thi công:", options: { A: "Thi công nền đường bằng máy có ưu điểm năng suất cao, chất lượng tốt, giá thành thấp", B: "Thi công nền đường bằng nổ phá đảm bảo nhanh chóng... nhưng yêu cầu tuyệt đối an toàn", C: "Thi công nền đường bằng thủ công có chất lượng tốt và năng suất thấp, giá thành thấp", D: "Thi công nền đường bằng sức nước là lợi dụng sức nước xói vào đất..." }, answer: "C" },
            { id: 9, question: "Phát biểu nào sau đây đúng nhất về phạm vi áp dụng:", options: { A: "Thi công nền đường bằng máy thích hợp với công trình có khối lượng đào đắp ít", B: "Thi công nền đường bằng nổ phá thường dùng ở những nơi đắp nền đường qua vùng đất yếu...", C: "Thi công nền đường bằng thủ công có chất lượng tốt và năng suất thấp, giá thành thấp", D: "Thi công nền đường bằng sức nước là lợi dụng sức nước xói vào đất..." }, answer: "D" },
            { id: 10, question: "Phát biểu nào sau đây đúng nhất:", options: { A: "Thi công nền đường bằng máy thích hợp với công trình có khối lượng đào đắp lớn, yêu cầu thi công nhanh, đòi hỏi chất lượng cao", B: "Thi công nền đường bằng nổ phá thường dùng ở những nơi đào nền đường qua vùng đá cứng...", C: "A và B đúng", D: "A và B sai" }, answer: "C" },
            { id: 11, question: "Kết cấu mặt đường bao gồm:", options: { A: "Các lớp tầng mặt", B: "Các lớp tầng mặt và các lớp tầng móng", C: "Các lớp tầng mặt, các lớp tầng móng và nền đất", D: "Các lớp tầng mặt, các lớp tầng móng, lớp đáy móng và nền đất." }, answer: "C" },
            { id: 12, question: "Vật liệu để làm các lớp mặt đường gồm có:", options: { A: "Cốt liệu; nhựa đường và phụ gia", B: "Cốt liệu; chất kết dính và phụ gia", C: "Cốt liệu; ximăng và phụ gia", D: "Cốt liệu; vôi và phụ gia" }, answer: "B" },
            { id: 13, question: "Yêu cầu đối với lớp mặt đường:", options: { A: "Đủ cường độ và ổn định cường độ", B: "Đủ cường độ, ổn định cường độ, đạt độ bằng phẳng và độ nhám", C: "Đủ cường độ, ổn định cường độ, đạt độ bằng phẳng, độ nhám và ít bụi", D: "Đủ cường độ, ổn định cường độ, đạt độ bằng phẳng, độ nhám và ít hư hỏng" }, answer: "C" },
            { id: 14, question: "Các lớp móng đường có tác dụng chính là:", options: { A: "Đảo đảm các biến dạng của nền đường nằm trong các giới hạn cho phép", B: "Phân bố đều áp lực lên nền đất và bảo đảm các biến dạng của nền đường nằm trong các giới hạn cho phép", C: "Phân bố đều áp lực lên nền đất và chịu được các lực thẳng đứng và lực ngang", D: "Đảm bảo các biến dạng của móng đường nằm trong các giới hạn cho phép" }, answer: "B" },
            { id: 15, question: "Tầng mặt đường áo đường mềm bao gồm các lớp:", options: { A: "Lớp hao mòn, lớp bảo vệ và các lớp chịu lực", B: "Lớp hao mòn, lớp bảo vệ, các lớp chịu lực và các lớp móng", C: "Lớp hao mòn, lớp bảo vệ, các lớp chịu lực; các lớp móng và lớp đáy móng", D: "Lớp hao mòn, lớp bảo vệ, các lớp chịu lực; các lớp móng và nền đường" }, answer: "A" },
            { id: 16, question: "Tầng mặt kết cấu áo đường mềm thường làm bằng vật liệu:", options: { A: "Hỗ hỗn hợp vật liệu hạt với nhựa đường", B: "Vật liệu hạt có xử lý bề mặt bằng nhựa đường", C: "Cả A và C sai", D: "Cả A và C đúng" }, answer: "D" },
            { id: 17, question: "Tầng móng kết cấu áo đường mềm thường được làm bằng vật liệu:", options: { A: "Vật liệu hạt không gia cố", B: "Vật liệu hạt gia cố chất kết dính vô cơ", C: "Vật liệu hạt gia cố chất kết dính hữu cơ", D: "Cả A, B, C đúng" }, answer: "D" },
            { id: 18, question: "Cấu tạo chung kết cấu áo đường cứng gồm:", options: { A: "Tầng móng + tấm bê tông xi măng lớp mặt", B: "Tầng móng + lớp bê tông nhựa trên mặt", C: "Tầng móng + lớp cấp phối đá dăm đen trên mặt", D: "Cả A, B và C đúng" }, answer: "A" },
            { id: 19, question: "Hỗn hợp vật liệu thông thường để xây dựng các lớp kết cấu mặt đường bao gồm các thành phần như sau:", options: { A: "Cốt liệu, nhũ tương và phụ gia", B: "Cốt liệu, nhựa đường và phụ gia", C: "Cốt liệu, chất liên kết và Phụ gia", D: "Cốt liệu, xi măng, phụ gia" }, answer: "C" },
            { id: 20, question: "Chất liên kết trong hỗn hợp vật liệu xây dựng các lớp kết cấu áo đường bao gồm:", options: { A: "Chất liên kết vô cơ; Chất liên kết hữu cơ và Chất liên kết khác", B: "Chất liên kết vô cơ; Chất liên kết hữu cơ; Chất liên kết tự nhiên", C: "Chất liên kết vô cơ; Chất liên kết hữu cơ; Chất liên kết nhân tạo", D: "Tất cả A, B, C đúng" }, answer: "A" },
            { id: 21, question: "Chất liên kết trong hỗn hợp vật liệu xây dựng các lớp kết cấu áo đường gồm:", options: { A: "Vôi; Xi măng và Bitum", B: "Vôi; Xi măng và puzolan", C: "Vôi; Xi măng và các chất liên kết rắn trong nước", D: "Vôi, các chất liên kết hữu cơ, các chất liên kết rắn trong nước và puzơlan" }, answer: "D" },
            { id: 22, question: "Các nguyên lý sử dụng vật liệu làm mặt đường cho các lớp kết cấu áo đường bao gồm:", options: { A: "Nguyên lý đá chèn đá, kiểu lát xếp, kiểu cấp phối", B: "Nguyên lý đá chèn đá, kiểu cấp phối, kiểu gia cố", C: "Nguyên lý đá chèn đá, kiểu lát xếp, kiểu cấp phối, kiểu gia cố", D: "Nguyên lý đá chèn đá, kiểu cấp phối, kiểu gia cố, gia cố đất" }, answer: "C" },
            { id: 23, question: "Lớp vật liệu đá dăm nước (hay đá dăm Macadam) làm mặt đường theo nguyên lý:", options: { A: "Nguyên lý đá chèn đá", B: "Nguyên lý cấp phối", C: "Nguyên lý gia cố", D: "Nguyên lý kiểu lát xếp" }, answer: "A" },
            { id: 24, question: "Lớp vật liệu đá dăm 4x6 kẹp đất dính làm mặt đường theo nguyên lý:", options: { A: "Nguyên lý cấp phối", B: "Nguyên lý đá chèn đá", C: "Nguyên lý lát xếp", D: "Nguyên lý gia cố" }, answer: "B" },
            { id: 25, question: "Lớp vật liệu đá dăm 4x6 kẹp vữa xi măng làm mặt đường theo nguyên lý:", options: { A: "Nguyên lý đá chèn đá", B: "Nguyên lý cấp phối", C: "Nguyên lý gia cố", D: "Nguyên lý lát xếp" }, answer: "A" },
            { id: 26, question: "Lớp vật liệu đá ba, đá hộc làm lớp móng hoặc gia cố rãnh thoát nước làm theo nguyên lý:", options: { A: "Nguyên lý đá chèn đá", B: "Nguyên lý cấp phối", C: "Nguyên lý gia cố", D: "Nguyên lý lát xếp" }, answer: "D" },
            { id: 27, question: "Lớp cấp phối đá dăm làm mặt đường theo nguyên lý:", options: { A: "Nguyên lý đá chèn đá", B: "Nguyên lý cấp phối", C: "Nguyên lý gia cố", D: "Cả A và C" }, answer: "B" },
            { id: 28, question: "Lớp cấp phối thiên nhiên làm mặt đường theo nguyên lý:", options: { A: "Nguyên lý đá chèn đá", B: "Nguyên lý cấp phối", C: "Nguyên lý gia cố", D: "Nguyên lý lát xếp" }, answer: "B" },
            { id: 29, question: "Lớp cấp phối đá dăm gia cố xi măng làm mặt đường theo nguyên lý:", options: { A: "Nguyên lý gia cố", B: "Nguyên lý cấp phối", C: "Nguyên lý gia cố và nguyên lý cấp phối", D: "Nguyên lý lát xếp và nguyên lý gia cố" }, answer: "C" },
            { id: 30, question: "Trình tự thi công các lớp kết cấu áo đường bao gồm các công việc sau:", options: { A: "Công tác chuẩn bị, công tác thi công lớp móng, công tác thi công lớp mặt", B: "Công tác chuẩn bị, công tác chính, công tác hoàn thiện.", C: "Công tác chuẩn bị, công tác thi công lớp móng, công tác thi công lớp mặt, công tác hoàn thiện", D: "Công tác thi công lớp móng, công tác thi công lớp mặt, công tác hoàn thiện" }, answer: "C" },
            { id: 31, question: "Khi xây dựng kết cấu áo đường, hạng mục lòng đường có thể gồm có các phương án thi công như sau:", options: { A: "Đào lòng đường hoàn toàn, đắp lề đường một phần, đào lòng đường một phần và đắp lề một phần.", B: "Đắp lề đường hoàn toàn, đào lòng đường một phần và đắp lề một phần.", C: "Đào lòng đường hoàn toàn, đắp lề đường hoàn toàn, đào lòng đường một phần và đắp lề một phần.", D: "Đắp lề đường hoàn toàn, đào lòng đường một phần và đắp lề một phần." }, answer: "C" },
            { id: 32, question: "Phát biểu nào sau đây không đúng về nguyên lý mặt đường:", options: { A: "Theo nguyên lý cấp phối thì cốt liệu sẽ gồm nhiều cỡ hạt to nhỏ khác nhau...", B: "Độ chặt của hỗn hợp vật liệu sau khi lu lèn càng lớn thì cường độ của lớp vật liệu càng cao", C: "Nhược điểm chính của phương pháp làm mặt đường theo nguyên lý cấp phối là khó cơ giới hoá...", D: "Mặt đường bê tông xi măng, mặt đường bê tông nhựa làm việc theo nguyên lý cấp phối" }, answer: "D" },
            { id: 33, question: "Phát biểu nào sau đây không đúng về gia cố đất:", options: { A: "Nguyên lý gia cố đất... dùng các chất liên kết... thay đổi tính chất cơ học...", B: "Nguyên lý gia cố đất... sử dụng vật liệu tại chỗ...", C: "Nguyên lý làm mặt đường theo kiểu chèn móc... đá dăm kích cỡ đồng đều...", D: "Nguyên lý làm mặt đường theo kiểu chèn móc có ưu điểm là ít tốn công lu" }, answer: "D" },
            { id: 34, question: "Mặt đường mềm sử dụng lớp móng gia cố xi măng thì:", options: { A: "Dưới tác dụng của tải trọng xe chạy lớp móng chịu tác dụng ứng suất kéo uốn", B: "Ứng suất nén thẳng đứng truyền xuống nền đất rất nhỏ", C: "Cả A và B sai", D: "Cả A và B đúng" }, answer: "D" },
            { id: 35, question: "Mặt đường mềm có lớp móng bằng vật liệu hạt thì:", options: { A: "Độ cứng của kết cấu mặt đường này phụ thuộc vào cường độ của nền đất và chiều dày của lớp móng", B: "Độ cứng của kết cấu mặt đường không phụ thuộc vào cường độ của nền đất và chiều dày của lớp móng", C: "Ứng suất nén thẳng đứng truyền xuống nền đất nhỏ hơn so lớp móng gia cố xi măng khi thiết kế cùng chiều dày", D: "Ứng suất kéo uốn lớn" }, answer: "A" },
            
            // Chương 2: Công tác đầm nén
            { id: 36, question: "Mục đích của đầm nén lớp vật liệu cấp phối đá dăm là:", options: { A: "Khí thoát ra ngoài", B: "Nước thoát ra ngoài", C: "Hạt nhỏ thoát ra ngoài", D: "Hạt mịn thoát ra ngoài" }, answer: "A" },
            { id: 37, question: "Bản chất của quá trình đầm nén vật liệu là do các đặc trưng của vật liệu bị ảnh hưởng như sau:", options: { A: "Tải trọng bên ngoài tác dụng làm cho độ chặt và modul đàn hồi vật liệu tăng lên", B: "Tải trọng bên ngoài tác dụng... độ chặt và modul đàn hồi vật liệu giảm xuống", C: "Tải trọng bên ngoài tác dụng... độ chặt và modul đàn hồi vật liệu tăng lên", D: "Tải trọng bên ngoài tác dụng, vật liệu phát sinh biến dạng..." }, answer: "A" },
            { id: 38, question: "Trong quá trình đầm nén các vật liệu làm kết cấu áo đường thông thường phát sinh các loại sức cản đầm nén sau:", options: { A: "Sức cản cấu trúc, sức cản nhớt, sức cản lăn", B: "Sức cản cấu trúc, sức cản nhớt, sức cản quán tính", C: "Sức cản quán tính, sức cản nhớt, sức cản ma sát", D: "Sức cản cấu trúc, sức cản quán tính, sức cản bề mặt" }, answer: "B" },
            { id: 39, question: "Các nhân tố ảnh hưởng đến hiệu quả đầm nén vật liệu bao gồm:", options: { A: "Áp lực đầm nén, Chiều dày lèn ép, Tốc độ đầm nén, Loại lu đầm", B: "Chiều dày lèn ép, Tốc độ đầm nén, Số lần đầm nén, Loại vật liệu", C: "Áp lực đầm nén, Chiều dày lèn ép, Tốc độ đầm nén, Số lần đầm nén", D: "Áp lực đầm nén, Chiều dày lèn ép, Tốc độ đầm nén, Số lần đầm nén, Loại vật liệu" }, answer: "D" },
            { id: 40, question: "Theo lý thuyết đầm nén, độ chặt vật liệu sẽ:", options: { A: "Tăng lên không ngừng khi tăng áp lực đầm nén", B: "Giảm xuống không ngừng khi tăng áp lực đầm nén", C: "Tăng đến giá trị cực trị khi tăng áp lực đầm nén", D: "Giảm đến giá trị cực trị khi tăng áp lực đầm nén" }, answer: "C" },
            { id: 41, question: "Chọn máy lu lèn vật liệu mặt đường phải đảm bảo các nguyên tắc sau:", options: { A: "Lớp vật liệu mặt đường phải đạt được độ chặt và cường độ cần thiết...", B: "Lớp vật liệu mặt đường phải đạt được độ chặt..., tải trọng đầm nén không phá hỏng cấu trúc nội bộ...", C: "Kết thúc quá trình đầm nén, lớp mặt đường phải bằng phẳng...", D: "Tốn ít công lu lèn nhất" }, answer: "B" },
            { id: 42, question: "Theo thiết kế sơ đồ lu (hình 1) thì số lượt lu qua một điểm trên mặt cắt ngang có thể là:", options: { A: "01 điểm, 02 điểm, 03 điểm hoặc 04 điểm.", B: "03 điểm.", C: "04 điểm.", D: "05 điểm." }, answer: "A" },
            { id: 43, question: "Theo qui định kỹ thuật, khi lu lèn lớp vật liệu mặt đường trên đường thẳng thì lu sẽ chạy thứ tự từ:", options: { A: "Tim sang mép", B: "Mép sang tim", C: "Chạy từ thấp lên cao", D: "Cả B và C" }, answer: "D" },
            { id: 44, question: "Theo qui định kỹ thuật, khi lu lèn lớp vật liệu mặt đường trong đường cong thì lu sẽ chạy thứ tự từ:", options: { A: "Từ lưng đường cong xuống bụng", B: "Từ bụng lên đến lưng đường cong", C: "Chạy vuông góc tim đường từ bụng lên lưng", D: "Cả A và C" }, answer: "B" },
            { id: 45, question: "Theo qui định kỹ thuật, khi lu lèn lớp vật liệu cấp phối đá dăm thì chiều dài đoạn lu căn cứ vào các đặc điểm sau:", options: { A: "Loại xe vận chuyển...", B: "Độ ẩm tốt nhất của vật liệu cấp phối đá dăm có thể đạt được khi lu trên đoạn này", C: "Chiều dài làm việc hiệu quả lu", D: "Cả B và C" }, answer: "D" },
            { id: 46, question: "Khi quyết định bề dày lớp vật liệu đầm nén hợp lý cần xét đến:", options: { A: "Bề dày lèn ép không quá lớn để đảm bảo ứng suất do áp lực truyền xuống...", B: "Bề dày cũng không nên nhỏ quá để đảm bảo cho tầng móng phía dưới", C: "Cả B và C đúng", D: "Cả B và C sai" }, answer: "A" },
            { id: 47, question: "Trong giai đoạn đầu, khi vật liệu mới rải, nên dùng lu:", options: { A: "Lu nặng", B: "Lu nhẹ", C: "Lu vừa", D: "Cả A và C" }, answer: "B" },
            { id: 48, question: "Trong giai đoạn đầu, khi vật liệu mới rải, không nên dùng lu:", options: { A: "Lu nặng", B: "Lu nhẹ", C: "Lu vừa", D: "Cả A và C" }, answer: "A" },
            { id: 49, question: "Trong giai đoạn đầu, khi vật liệu mới rải, nên dùng lu và tốc độ lu hướng dẫn kỹ thuật như sau:", options: { A: "Lu nặng và lu nhanh", B: "Lu nhẹ và lu chậm", C: "Lu vừa và lu nhanh", D: "Lu nhẹ và lu nhanh" }, answer: "B" },
            { id: 50, question: "Chất lượng đầm nén được đánh giá bằng cách xác định các chỉ tiêu:", options: { A: "Modul đàn hồi lớp vật liệu lu lèn hoặc độ chặt lớp vật liệu", B: "Độ ẩm tốt nhất", C: "Đo độ bằng phẳng", D: "Cả B và C" }, answer: "A" },
            { id: 51, question: "Thiết kế sơ đồ lu lèn cho các phương tiện đầm nén cần đảm bảo các nguyên tắc sau:", options: { A: "Số lần đầm nén phải đảm bảo đồng đều đối với tất cả mọi điểm...", B: "Phải bố trí đầm nén sao cho tạo điều kiện tăng nhanh hiệu quả đầm nén...", C: "Số lần đầm nén phải đảm bảo đồng đều đối với tất cả mọi điểm...", D: "Số lần đầm nén theo khối lượng vật liệu đoạn lu" }, answer: "B" },
            { id: 52, question: "Trong quá trình đầm nén không phát sinh các loại sức cản đầm nén sau:", options: { A: "Sức cản cấu trúc và sức cản nhớt", B: "Sức cản cấu trúc và sức cản quán tính", C: "Sức cản bề mặt và sức cản ma sát", D: "Sức cản quán tính và sức cản quán tính" }, answer: "C" },
            { id: 53, question: "Khi chọn lu để đầm nén thì cần phải xét tới các điều kiện chủ yếu sau:", options: { A: "Áp lực tác dụng của lu trên mặt lớp vật liệu phải phù hợp với trị số cho phép...", B: "Áp lực tác dụng của lu trên mặt lớp vật liệu phải phù hợp với trị số cho phép...", C: "Áp lực tác dụng của lu trên mặt lớp vật liệu phải phù hợp với trị số cho phép...", D: "Áp lực tác dụng của lu trên mặt lớp vật liệu phải phù hợp với trị số cho phép..." }, answer: "A" },
            { id: 54, question: "Quyết định chiều dài thao tác của lu khi đầm nén mặt đường cần dựa vào các điểm sau:", options: { A: "Kỹ thuật thi công mỗi loại mặt đường và yêu cầu phối hợp các khâu công tác...", B: "Kỹ thuật thi công mỗi loại lu khác nhau", C: "Trong những điều kiện cho phép thì không được tăng chiều dài thao tác của lu.", D: "A, B, C đúng" }, answer: "D" },
            { id: 55, question: "Khi đầm nén tầng móng thì hành trình đầu tiên cách mép lề tối thiểu bao nhiêu (cm) để tránh phá hoại lề?", options: { A: "20 cm", B: "15 cm", C: "10 cm", D: "5 cm" }, answer: "A" },
            
            // Chương 3: Thi công nền đường
            { id: 56, question: "Không được sử dụng trực tiếp các loại đất dưới đây để đắp bất cứ bộ phận nào của nền đường:", options: { A: "Đất bùn, đất than bùn; đất mùn lẫn hữu cơ quá 10,0%", B: "Đất sét có độ trương nở cao vượt quá 3,0%...", C: "Cả A và B đúng", D: "A và B sai" }, answer: "C" },
            { id: 57, question: "Được sử dụng trực tiếp các loại đất dưới đây để đắp bất cứ bộ phận nào của nền đường:", options: { A: "Đất bùn...", B: "Đất sét có độ trương nở cao...", C: "Cả A và B đúng", D: "A và B sai" }, answer: "D" },
            { id: 58, question: "Các trường hợp nào dưới đây không cần phải có thiết kế biện pháp xử lý mặt nền tự nhiên:", options: { A: "Nền đắp cao, nền đắp bằng đá...", B: "Mặt nền tự nhiên là đất lẫn đá...", C: "Cả A và B đúng", D: "Cả A và B sai" }, answer: "D" },
            { id: 59, question: "Các trường hợp nào dưới đây cần phải có thiết kế biện pháp xử lý mặt nền tự nhiên:", options: { A: "Nền đắp cao, nền đắp bằng đá... Đắp qua hồ, ao...", B: "Mặt nền tự nhiên là đất lẫn đá...", C: "Cả A và B đúng", D: "Cả A và B sai" }, answer: "A" },
            { id: 60, question: "Bất kể dùng loại phương tiện đầm nén nào đều phải tuân theo các quy định sau (đoạn 1):", options: { A: "Phải đầm nén đồng đều... từ chỗ cao đến chỗ thấp... 15-20cm...", B: "Phải đầm nén đồng đều... từ chỗ thấp đến chỗ cao...", C: "Phải đầm nén đồng đều... từ chỗ thấp đến chỗ cao... 5-10cm...", D: "Cả A, B, C sai" }, answer: "D" },
            { id: 61, question: "Bất kể dùng loại phương tiện đầm nén nào đều phải tuân theo các quy định sau (đoạn 2):", options: { A: "Từ chỗ cao đến chỗ thấp...", B: "Từ chỗ thấp đến chỗ cao... đè lên nhau 1/4...", C: "Từ chỗ thấp đến chỗ cao... 5-10cm...", D: "Phải đầm nén đồng đều suốt bề rộng nền đường từng lượt trên mỗi đoạn thi công theo trình tự từ chỗ thấp đến chỗ cao..." }, answer: "D" },
            { id: 62, question: "Kiểm tra chất lượng đắp đất trong quá trình thi công:", options: { A: "Mỗi lớp đất đầm nén xong đều phải kiểm tra độ chặt...", B: "Kết quả kiểm tra phải đạt trị số độ chặt K tối thiểu...", C: "Khi kiểm tra bằng phương pháp rót cát hoặc túi nước...", D: "Cả A, B, C đúng" }, answer: "D" },
            { id: 63, question: "Để bảo đảm chất lượng đầm nén vùng sát gần mặt ta luy, bề rộng đắp mỗi lớp nên rộng hơn:", options: { A: "Từ 15 cm đến 20 cm", B: "Từ 10 cm đến 15 cm", C: "Từ 5 cm đến 10 cm", D: "Từ 20 cm đến 50 cm" }, answer: "D" },
            { id: 64, question: "Trong mọi trường hợp đắp đoạn tiếp giáp phải rải và đầm nén từng lớp dẫn từ dưới lên với bề dày lớp đầm nén chỉ nên từ:", options: { A: "15 cm đến 20 cm", B: "10 cm đến 20 cm", C: "5 cm đến 10 cm", D: "20 cm đến 50 cm" }, answer: "A" },
            { id: 65, question: "Độ chặt yêu cầu trong toàn phạm vi đắp đoạn tiếp giáp phải đạt:", options: { A: ">= 0,98 đối với đường cao tốc, đường cấp I, cấp II...", B: ">= 0,95 đối với đường cao tốc...", C: ">= 0,95 đối với mọi cấp đường", D: ">= 0,90 đối với mọi cấp đường" }, answer: "A" },
            { id: 66, question: "Khi xây dựng nền đường trên sườn dốc, sử dụng biện pháp đánh cấp khi độ dốc ngang:", options: { A: "< 20%", B: "40%", C: "> 50%", D: "Cả A, B và C đều sai" }, answer: "B" },
            { id: 67, question: "Nền tự nhiên dốc ngang bao nhiêu thì chỉ cần đào bỏ lớp đất hữu cơ rồi đắp trực tiếp:", options: { A: "< 20%", B: "< 10%", C: "< 30%", D: "< 50%" }, answer: "A" },
            { id: 68, question: "Nền tự nhiên dốc ngang bao nhiêu thì phải thiết kế công trình chống đỡ (tường chắn, tường chân...):", options: { A: "> 20%", B: "20-50%", C: "> 50%", D: "> 40%" }, answer: "C" },
            { id: 69, question: "Kiểm tra phục vụ cho việc nghiệm thu một đoạn nền đường phải thực hiện nội dung sau:", options: { A: "Kiểm tra các biên bản đã thực hiện", B: "Kiểm tra các yếu tố hình học", C: "Kiểm tra chất lượng trồng cây, cỏ gia cố...", D: "Cả A, B, C đúng" }, answer: "D" },
            { id: 70, question: "Theo TCVN 9436:2012, Đối với nền đắp cho đường cao tốc, cấp I, cấp II (30 cm trên cùng), yêu cầu CBR nhỏ nhất:", options: { A: "8%", B: "7%", C: "6%", D: "5%" }, answer: "A" },
            { id: 71, question: "Theo TCVN 9436:2012, Đối với nền đắp cho đường cao tốc, cấp I, cấp II (từ 30 cm đến 80 cm), yêu cầu CBR nhỏ nhất:", options: { A: "8%", B: "7%", C: "6%", D: "5%" }, answer: "C" },
            
            // Chương 4: Mặt đường đá dăm, cấp phối và gia cố
            { id: 72, question: "Khái niệm mặt đường đá dăm nước là:", options: { A: "Mặt đường dùng đá có cường độ cao, cùng loại...", B: "Mặt đường dùng đá... kích cỡ đồng đều, sần sùi, sắc cạnh; rải theo nguyên lý cấp phối", C: "Mặt đường dùng đá... làm việc theo nguyên lý đá chèn đá", D: "Mặt đường dùng đá... rải theo nguyên lý đá chèn đá" }, answer: "C" },
            { id: 73, question: "Ưu điểm của mặt đường đá dăm nước là:", options: { A: "Có cường độ cao, không đòi hỏi thiết bị thi công phức tạp", B: "Có cường độ cao... ít bị ảnh hưởng của ẩm ướt", C: "Thi công dễ dàng... chi phí thấp...", D: "Thi công dễ dàng..." }, answer: "B" },
            { id: 74, question: "Nhược điểm của mặt đường đá dăm nước là:", options: { A: "Không chịu được tải trọng nặng", B: "Không chịu được tải trọng động... yêu cầu về cường độ vật liệu đá cao...", C: "Yêu cầu về cường độ vật liệu đá cao...", D: "Tất cả A, B, C đúng" }, answer: "D" },
            { id: 75, question: "Theo TCVN 9054-2012, Chiều dày tối thiểu của một lớp đá dăm nước sử dụng kích cỡ đá từ 50 đến 25mm:", options: { A: "6 cm", B: "7 cm", C: "8 cm", D: "10 cm" }, answer: "A" },
            { id: 76, question: "Theo TCVN 9054-2012, Chiều dày tối đa của một lớp đá dăm nước sử dụng kích cỡ đá từ 50 đến 25mm:", options: { A: "10 cm", B: "12 cm", C: "15 cm", D: "20 cm" }, answer: "C" },
            { id: 77, question: "Chỉ tiêu kỹ thuật yêu cầu của cốt liệu cho mặt đường đá dăm nước bao gồm:", options: { A: "Cường độ nén, Độ hao mòn Losangeles, Lượng hạt dẹt, hàm lượng bụi và hạt mềm yếu", B: "Độ hao mòn Losangeles, Đá dẹt, cỡ đá...", C: "Cường độ nén, Đá dẹt, cỡ đá...", D: "Cường độ nén, Độ hao mòn Losangeles..." }, answer: "A" },
            { id: 78, question: "Theo TCVN 9054-2012, yêu cầu về cường độ nén (Rn) của đá gốc (đá mama, đá biến chất) cho lớp mặt đường đá dăm nước:", options: { A: "Rn >= 40 MPa", B: "Rn >= 50 MPa", C: "Rn >= 70 MPa", D: "Rn >= 100 MPa" }, answer: "C" },
            { id: 79, question: "Theo chỉ dẫn kỹ thuật (TCVN 9054-2012), yêu cầu về độ hao mòn khi va đập trong máy Losangeles (%), cốt liệu làm lớp mặt phải đảm bảo:", options: { A: "LA <= 15%", B: "LA <= 18%", C: "LA <= 20%", D: "LA <= 28%" }, answer: "D" },
            { id: 80, question: "Theo định nghĩa kích cỡ đá dăm, thì đá dăm 4x6 cỡ hạt theo bộ sàng tiêu chuẩn lỗ tròn (mm):", options: { A: "Nằm trên sàng 40 lọt sàng 60", B: "Nằm trên sàng 40 không lọt sàng 60", C: "Nằm dưới sàng 40 lọt sàng 60", D: "Tất cả A, B, C không đúng" }, answer: "A" },
            { id: 81, question: "Theo chỉ dẫn kỹ thuật (TCVN 9054-2012), công tác chuẩn bị thi công mặt đường đá dăm nước:", options: { A: "Nền đường, lớp móng dưới, lớp móng trên phải bằng phẳng, đạt độ chặt và đã được nghiệm thu", B: "Nền đường... không yêu cầu nghiệm thu...", C: "Chỉ nền đường được yêu cầu nghiệm thu...", D: "Chỉ móng dưới được yêu cầu nghiệm thu..." }, answer: "A" },
            { id: 82, question: "Theo chỉ dẫn kỹ thuật (TCVN 9054-2012), Các giai đoạn lu lèn mặt đường đá dăm nước gồm:", options: { A: "Lèn xếp - lu vừa - lu lèn chặt - lu lèn hoàn thiện", B: "Lèn xếp – Lu Rung - Lu lèn chặt - Lu lèn hoàn thiện", C: "Lèn xếp - Lu lèn chặt - Lu lèn hoàn thiện", D: "Lèn xếp - Lu lèn hoàn thiện - Lu tạo bằng phẳng" }, answer: "C" },
            { id: 83, question: "Theo TCVN 8857-2011, cấp phối thiên nhiên là:", options: { A: "Là một hỗn hợp vật liệu dạng hạt... kích cỡ 3mm-5mm...", B: "Là một hỗn hợp vật liệu dạng hạt có sẵn trong tự nhiên theo nguyên lý cấp phối", C: "Là một hỗn hợp vật liệu dạng hạt... kích cỡ 4x6", D: "Là một hỗn hợp vật liệu dạng hạt... kích cỡ 2x4" }, answer: "B" },
            { id: 84, question: "Trình tự chung thi công vật liệu cấp phối thiên nhiên gồm các bước:", options: { A: "Công tác chuẩn bị - vận chuyển cấp phối – San cấp phối – Lu lèn – Bảo dưỡng", B: "Công tác chuẩn bị - vận chuyển cấp phối – Lu lèn – Bảo dưỡng", C: "Công tác chuẩn bị - vận chuyển cấp phối – San cấp phối – Bảo dưỡng", D: "Công tác chuẩn bị - San cấp phối – Lu lèn – Bảo dưỡng" }, answer: "A" },
            { id: 85, question: "Theo TCVN 8857-2011, thì công tác san rải cấp phối phải đảm bảo:", options: { A: "Chiều dày mỗi lớp (đã lu lèn chặt) không quá 15cm", B: "Chiều dày mỗi lớp (đã lu lèn chặt) không quá 20cm", C: "Chiều dày mỗi lớp (đã lu lèn chặt) không quá 35cm", D: "Chiều dày mỗi lớp (đã lu lèn chặt) không quá 30cm" }, answer: "A" },
            { id: 86, question: "Theo TCVN 8857-2011, Khi đang thi công lớp vật liệu cấp phối thiên nhiên gặp trời mưa thì:", options: { A: "Ngừng san rải và lu lèn cấp phối", B: "Đợi tạnh mưa, bốc hơi để đạt độ ẩm tốt nhất", C: "Không chờ tạnh mưa vẫn san rải, lu lèn", D: "Cả A và B" }, answer: "D" },
            { id: 87, question: "Theo định nghĩa: Cấp phối đá dăm loại I là:", options: { A: "Là cấp phối hạt", B: "Các cỡ hạt được nghiền từ đá nguyên khai", C: "Các cỡ hạt đồng kích cỡ 4x6", D: "Cả A và B" }, answer: "D" },
            { id: 88, question: "Theo TCVN 8859-2011 - chỉ tiêu cơ lý yêu cầu thì độ chặt đầm nén Kyc (%) cấp phối đá dăm loại I và loại II là:", options: { A: "Kyc >= 95", B: "Kyc >= 96", C: "Kyc >= 97", D: "Kyc >= 98" }, answer: "D" },
            { id: 89, question: "Theo TCVN 8859-2011, yêu cầu về độ ẩm vật liệu cấp phối đá dăm cho việc thi công là:", options: { A: "W ± 2%", B: "W ± 3%", C: "W ± 4%", D: "W ± 5%" }, answer: "A" },
            { id: 90, question: "Mặt, móng đường bằng đất gia cố chất kết dính vô cơ là:", options: { A: "Đất tại chỗ hay chọn lựa... trộn các chất dính vô cơ (vôi, xi măng) và lu lèn chặt...", B: "Cấp phối đá thiên nhiên...", C: "Cấp phối đá dăm đen...", D: "Đá dăm 4x6..." }, answer: "A" },
            { id: 91, question: "Yêu cầu thành phần vật liệu của đất gia cố gồm:", options: { A: "Đất + Xi măng hoặc vôi + Nước + Chất phụ gia (nếu có)", B: "Đất + Nhũ tương + Nước + Chất phụ gia (nếu có)", C: "Đất + Bitum + Nước + Chất phụ gia (nếu có)", D: "Tất cả A, B, C đúng" }, answer: "A" },
            { id: 92, question: "Trình tự thi công đất gia cố bao gồm một số công việc chủ yếu sau:", options: { A: "Công tác làm tơi đất; Rải và trộn cát, Rải và trộn chất gia cố hoặc phụ gia; Đầm lèn... Bảo dưỡng", B: "Công tác làm tơi đất; Rải và trộn chất gia cố... Đầm lèn... Bảo dưỡng", C: "Công tác làm tơi đất; Tưới nước...", D: "Công tác làm tơi đất; Tưới nước, Rải cát..." }, answer: "A" },
            { id: 93, question: "Trước khi quyết định gia cố đất phải làm thí nghiệm:", options: { A: "Tính chất lý hóa của đất và Tính chất cơ lý, hóa của chất kết dính...", B: "Tính chất cơ lý của hỗn hợp đất và chất kết dính", C: "Tính chất lý hóa của đất và Tính chất cơ lý, hóa của chất kết dính...; Tính chất cơ lý của hỗn hợp đất và chất kết dính", D: "Tính chất lý hóa của đất..." }, answer: "C" },
            { id: 94, question: "Theo TCVN 8858-2023, Cỡ hạt lớn nhất danh định của cấp phối đá dăm gia cố xi măng bao gồm:", options: { A: "Dmax= 50 mm, Dmax= 37.5 mm, Dmax= 31.5 mm và Dmax= 25 mm", B: "Dmax= 31.5 mm, Dmax= 25 mm, Dmax= 19mm và Dmax= 16mm", C: "Dmax= 25 mm, Dmax= 19mm và Dmax= 16mm và Dmax= 12.5mm", D: "Dmax= 37.5 mm, Dmax= 31.5 mm, Dmax= 25 mm và Dmax= 19mm" }, answer: "D" },
            { id: 95, question: "Theo TCVN 8858-2023, Lượng xi măng (tính theo khối lượng hỗn hợp cốt liệu khô) thường được lựa chọn trong khoảng từ ... đến ... đối với cốt liệu là cấp phối đá dăm:", options: { A: "3%-6%", B: "2,5%-6%", C: "4%-6%", D: "4%-10%" }, answer: "A" },
            { id: 96, question: "Theo TCVN 8858-2023, hỗn hợp cấp phối gia cố xi măng phải được lu lèn ở độ ẩm tốt nhất với sai số cho phép về độ ẩm là:", options: { A: "-1%", B: "-1,5%", C: "- 2%", D: "- 2,5%" }, answer: "C" },
            { id: 97, question: "Theo TCVN 8858-2023, số ngày bảo dưỡng yêu cầu đối với lớp cấp phối đá dăm gia cố xi măng để thi công tiếp lớp kết cấu bên trên là:", options: { A: "Ít nhất sau 17 ngày", B: "Ít nhất sau 16 ngày", C: "Ít nhất sau 15 ngày", D: "Ít nhất sau 14 ngày" }, answer: "D" },
            { id: 98, question: "Theo TCVN 8858-2023, Để kiểm soát nứt phản ảnh xảy ra khi lớp cấp phối đá dăm gia cố xi măng bị nứt cần sử dụng các giải pháp sau:", options: { A: "Sử dụng lớp hỗn hợp đá nhựa", B: "Lưới sợi thủy tinh", C: "Giải pháp cắt khe giả", D: "A, B, C đúng" }, answer: "D" },

            // Chương 5: Bê tông nhựa
            { id: 99, question: "Theo TCVN 13567:2022, định nghĩa hỗn hợp bê tông nhựa nóng là:", options: { A: "Hỗn hợp bao gồm các cốt liệu... nhũ tương và phụ gia...", B: "Hỗn hợp bao gồm các cốt liệu... nhựa đường được trộn nóng...", C: "Hỗn hợp bao gồm các cốt liệu... nhựa đường và phụ gia (nếu có) theo tỷ lệ xác định, được trộn nóng ở nhiệt độ thích hợp tại trạm trộn và được rải nóng trong quá trình thi công tại hiện trường.", D: "Tất cả A, B, C sai" }, answer: "C" },
            { id: 100, question: "Độ rỗng dư trong Bê tông nhựa là:", options: { A: "Tổng thể tích của tất cả các lỗ rỗng nhỏ nằm giữa các hạt cốt liệu đã được bọc nhựa trong hỗn hợp đá nhựa đã đầm nén", B: "Tổng thể tích của tất cả các lỗ rỗng nhỏ nằm giữa các hạt cốt liệu đã được bọc nhựa trong hỗn hợp đá nhựa", C: "Tổng thể tích của tất cả các lỗ rỗng nhỏ nằm giữa các hạt cốt liệu...", D: "Tổng thể tích của tất cả các lỗ rỗng lớn nhỏ khác nhau..." }, answer: "A" },
            { id: 101, question: "Chiều dầy hợp lý của Bê tông nhựa chặt (BTNC 12.5) (sau khi đầm nén) là:", options: { A: "5-7cm", B: "6-8cm", C: "4-5cm", D: "7-9cm" }, answer: "C" },
            { id: 102, question: "Theo TCVN 13567-1:2022, định nghĩa độ rỗng dư của hỗn hợp bê tông nhựa là:", options: { A: "Tổng thể tích của tất cả các hạt cốt liệu...", B: "Tổng thể tích của hàm lượng nhựa...", C: "Tổng thể tích của tất cả các lỗ rỗng nhỏ nằm giữa các hạt cốt liệu đã được bọc nhựa trong hỗn hợp đá nhựa đã đầm nén. Độ rỗng dư được biểu thị bằng phần trăm của thể tích mẫu hỗn hợp đá nhựa đã đầm nén", D: "Tổng thể tích của tất cả các hạt cốt liệu và nhựa..." }, answer: "C" },
            { id: 103, question: "Theo TCVN 13567-1:2022, Bê tông nhựa chặt C12.5 (viết tắt BTNC 12,5) nghĩa là:", options: { A: "Có cỡ hạt lớn nhất danh định là 9.5 mm và cỡ hạt lớn nhất là 12.5 mm", B: "Có cỡ hạt lớn nhất danh định là 12,5 mm và cỡ hạt lớn nhất là 16 mm", C: "Có cỡ hạt lớn nhất danh định là 12,5 mm và cỡ hạt lớn nhất là 19 mm", D: "Có cỡ hạt lớn nhất danh định là 12.5 mm và cỡ hạt lớn nhất là 9.5 mm" }, answer: "D" },
            { id: 104, question: "Theo TCVN 13567-1:2022, yêu cầu thành phần vật liệu chế tạo hỗn hợp bê tông nhựa là:", options: { A: "Cốt liệu; Bột khoáng; Nhựa đường; Phụ gia", B: "Cốt liệu; Cát, Bột khoáng; Nhựa đường; Phụ gia", C: "Cốt liệu; Bột khoáng; Nhựa đường", D: "Cốt liệu lớn; Cốt liệu nhỏ; Bột khoáng; Nhựa đường; Phụ gia" }, answer: "D" },
            { id: 105, question: "Theo TCVN 13567-1:2022, Yêu cầu độ dính bám đá - nhựa đường, cấp:", options: { A: ">= 2", B: ">= 3", C: ">= 4", D: "A,B,C sai" }, answer: "C" },
            { id: 106, question: "Theo TCVN 13567-1:2022, Nhiệt độ quy định bắt đầu lu lèn của hỗn hợp bê tông nhựa với nhựa đường 60/70 tại hiện trường là:", options: { A: ">= 115 độ C", B: ">= 100 độ C", C: ">= 110 độ C", D: ">= 120 độ C" }, answer: "D" },
            { id: 107, question: "Theo TCVN 13567-1:2022, Nhiệt độ quy định kết thúc quá trình lu lèn của hỗn hợp bê tông nhựa với nhựa đường 60/70 tại hiện trường (dùng lu bánh thép) là:", options: { A: ">= 80 độ C", B: ">= 70 độ C", C: ">= 95 độ C", D: "> 50 độ C" }, answer: "A" },
            { id: 108, question: "Theo TCVN 13567-1:2022, lu lèn lớp hỗn hợp bê tông nhựa; thiết bị lu lèn bê tông nhựa gồm có ít nhất là:", options: { A: "Lu bánh thép nặng 10-12 tấn và lu bánh hơi có lốp nhẵn đi theo một máy rải", B: "Lu bánh thép nhẹ 6-8 tấn...", C: "Lu bánh thép nhẹ 6-8 tấn, lu bánh thép nặng 10-12 tấn và lu bánh hơi có lốp nhẵn đi theo một máy rải", D: "Lu bánh thép nhẹ 6-8 tấn đi theo một máy rải" }, answer: "C" },
            { id: 109, question: "Theo TCVN 13567-1:2022, Công tác kiểm tra kích thước hình học khi nghiệm thu lớp BTNC bao gồm:", options: { A: "Bề rộng, Độ dốc ngang, Chiều dày, Cao độ; Độ bằng phẳng của bề mặt", B: "Bề rộng, Độ dốc ngang, Chiều dày, Cao độ; Độ nhám", C: "Bề rộng, Độ dốc ngang, Chiều dày, Cao độ;", D: "Bề rộng, Độ dốc ngang, Chiều dày, Cao độ; Sức kháng trượt của bề mặt" }, answer: "A" },
            { id: 110, question: "Theo TCVN 13567-1:2022, Kết thúc lu lèn phải chờ lớp BTNC giảm nhiệt độ bề mặt bao nhiêu °C mới được cho thông xe:", options: { A: "70 độ C", B: "60 độ C", C: "50 độ C", D: "40 độ C" }, answer: "C" },

            // Chương 6: Mặt đường Bê tông xi măng
            { id: 111, question: "Theo TCCS40:2022/TCĐBVN, định nghĩa áo đường cứng là:", options: { A: "Loại kết cấu áo đường có tầng mặt làm bằng bê tông xi măng cốt thép và tầng móng làm bằng các vật liệu khác nhau...", B: "Loại kết cấu áo đường có tầng mặt làm bằng bê tông xi măng và tầng móng làm bằng các vật liệu khác nhau, đặt trực tiếp trên nền đường hoặc trên lớp đáy móng", C: "Loại kết cấu áo đường có tầng mặt làm cấp phối đá dăm gia cố xi măng...", D: "Loại kết cấu áo đường có tầng mặt làm bằng lớp hỗn hợp vữa xi măng..." }, answer: "B" },
            { id: 112, question: "Theo TCCS40:2022/TCĐBVN, cường độ nén và cường độ kéo khi uốn của mặt đường BTXM được quy định căn cứ vào:", options: { A: "Cấp hạng đường và tốc độ thiết kế", B: "Cấp hạng đường và loại tầng mặt", C: "Cấp hạng đường và tuổi mẫu thử", D: "Cấp hạng đường và quy trình thi công" }, answer: "A" },
            { id: 113, question: "Theo TCCS40:2022/TCĐBVN, tuổi mẫu thử xác định cường độ nén và cường độ kéo khi uốn là:", options: { A: "3 ngày và 56 ngày tuổi", B: "3 ngày và 14 ngày tuổi", C: "3 ngày và 28 ngày tuổi", D: "3 ngày và 7 ngày tuổi" }, answer: "C" },
            { id: 114, question: "Theo TCCS40:2022/TCĐBVN, cường độ kéo khi uốn (MPa) của mẫu thử sau 28 ngày tuổi của đường cấp IV là:", options: { A: ">= 6.5", B: ">= 5.0", C: ">= 4.5", D: ">= 3.5" }, answer: "D" },
            { id: 115, question: "Theo TCCS40:2022/TCĐBVN, yêu cầu về cốt liệu nhỏ (cát) cho hỗn hợp BTXM có nguồn gốc là:", options: { A: "Nghiền từ đá gốc", B: "Cát sông sạch", C: "Cát trộn của A và B", D: "Tất cả A, B, C" }, answer: "D" },
            { id: 116, question: "Theo TCCS40:2022/TCĐBVN, công tác chuẩn bị thi công mặt đường BTXM bao gồm các công việc sau:", options: { A: "1/Lựa chọn công nghệ thi công 2/Chuẩn bị xe máy thi công 3/Lập hồ sơ bản vẽ thi công 4/Bố trí và xây lắp trạm trộn BTXM 5/ Chuẩn bị xe lu nền đường", B: "... 5/Chuẩn bị nền, móng", C: "... 5/ Chuẩn bị xe lu móng đường", D: "... 5/ Chuẩn bị xe lu móng đường" }, answer: "B" },
            { id: 117, question: "Theo TCCS40:2022/TCĐBVN, mặt đường BTXM phải đình chỉ không được thi công trong các điều kiện sau:", options: { A: "Mưa tại hiện trường, tốc độ gió 10.8 m/s (cấp 6 trở lên)", B: "Mưa tại hiện trường, tốc độ gió 10.8 m/s (cấp 6 trở lên), Nhiệt độ không khí hiện trường >= 40 độ C hoặc nhiệt độ hỗn hợp khi rải > 35 độ C, Nhiệt độ không khí hiện trường trung bình trong 5 ngày liên tục thi công < 5 độ C", C: "Nhiệt độ không khí hiện trường trung bình trong 5 ngày liên tục thi công < 5 độ C", D: "Nhiệt độ không khí hiện trường >= 40 độ C hoặc nhiệt độ hỗn hợp khi rải > 35 độ C" }, answer: "B" },
            { id: 118, question: "Theo TCCS40:2022/TCĐBVN, yêu cầu về cỡ hạt danh định của cốt liệu thô sử dụng đá dăm để chế tạo hỗn hợp BTXM làm mặt đường, không lớn hơn:", options: { A: "37,5mm", B: "31,5mm", C: "25mm", D: "19mm" }, answer: "A" },
            { id: 119, question: "Theo TCCS40:2022/TCĐBVN, Thời gian bảo dưỡng phải được xác định tuy theo thời gian cường độ kéo khi uốn của hỗ hợp BTXM vừa rải đạt tối thiểu bao nhiêu (%) cường độ kéo khi uốn thiết kế?", options: { A: "50%", B: "60%", C: "70%", D: "80%" }, answer: "D" },
            { id: 120, question: "Theo TCCS40:2022/TCĐBVN, vật liệu làm lớp ngăn cách giữa lớp móng và lớp BTXM có thể xử dụng:", options: { A: "Đá dăm nhỏ hoặc bê tông nghèo", B: "Đá trộn nhựa", C: "Giấy dầu hoặc vải địa kỹ thuật", D: "Tất cả A, B, C đúng" }, answer: "D" },
            { id: 121, question: "Cấu tạo chung kết cấu mặt đường bê tông xi măng:", options: { A: "Tấm bê tông xi măng; khe co; khe dãn; Lớp móng trên, lớp móng dưới; nền đường", B: "Tấm bê tông xi măng; lớp dãn cách; lớp móng trên, lớp móng dưới; nền đường", C: "Tấm bê tông xi măng; Cốt thép; Lớp móng trên, lớp móng dưới; nền đường", D: "Tất cả A, B, C đúng" }, answer: "D" },
            { id: 122, question: "Trình tự thi công mặt đường bê tông xi măng:", options: { A: "Thi công lớp móng; Chuẩn bị vật liệu... Lắp đặt ván khuôn...", B: "Thi công lớp móng... bố trí khe nối; Trộn và vận chuyển...", C: "Thi công lớp móng; Chuẩn bị vật liệu; Xử lý bề mặt lớp móng, làm lớp cách ly; Lắp đặt ván khuôn; Gia công và lắp đặt cốt thép, bố trí khe nối; Trộn và vận chuyển hỗn hợp BTXM; Rải và đầm nén hỗn hợp BTXM; Hoàn thiện bề mặt BTXM; Làm khe nối; Bảo dưỡng; Kiểm tra nghiệm thu", D: "Thi công lớp móng... Gia công và lắp đặt cốt thép; Lắp đặt ván khuôn; bố trí khe nối..." }, answer: "C" },
            { id: 123, question: "Nhược điểm mặt đường bê tông xi măng:", options: { A: "Độ bền thấp, thời gian bảo dưỡng dài; yêu cầu máy móc thi công cao", B: "Khó sửa chữa; thời gian bảo dưỡng dài; tầm nhìn kém", C: "Khó sửa chữa; thời gian bảo dưỡng dài; Cảm giác người lái xe không thoải mái - do mối nối", D: "Độ bền thấp, thời gian bảo dưỡng dài; Cảm giác người lái xe không thoải mái - do mối nối" }, answer: "C" }
        ];

        // --- HẾT PHẦN DỮ LIỆU CÂU HỎI ---

        const script_elements = {
            quizForm: document.getElementById('quiz-form'),
            timerDisplay: document.getElementById('timer-display'),
            setupContainer: document.getElementById('setup-container'),
            quizContainer: document.getElementById('quiz-container'),
            startButton: document.getElementById('start-button'),
            shuffleButton: document.getElementById('shuffle-button'),
            submitButton: document.getElementById('submit-button'),
            finalResultScreen: document.getElementById('final-result-screen'),
            stickyHeader: document.getElementById('sticky-header'),
            mainContainer: document.getElementById('main-container'),
            contentPadding: document.getElementById('content-padding'),
            usernameInput: document.getElementById('username-input'),
            userCredit: document.getElementById('user-credit'),
            leaderboardScreen: document.getElementById('leaderboard-screen'),
            leaderboardBody: document.getElementById('leaderboard-body'),
            viewLeaderboardBtn: document.getElementById('view-leaderboard-btn')
        };
        
        let score = 0;
        let timerInterval;
        let quizData = [];
        const incorrectlyAttemptedQuestions = []; 
        let currentUsername = "";

        // ----------------------------------------------------
        // Logic Firebase (Giữ nguyên)
        // ----------------------------------------------------

        // Hàm lưu điểm lên Firebase
        function saveScoreToLeaderboard(name, score) {
            const now = new Date();
            const dateString = now.toLocaleDateString('vi-VN') + ' ' + now.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'});
            
            // Push dữ liệu mới vào nhánh 'quiz_leaderboard'
            push(ref(db, 'quiz_leaderboard'), {
                name: name,
                score: score,
                timestamp: dateString,
                createdAt: Date.now() // Dùng để sort timestamp nếu cần
            });
        }

        // Hàm lấy dữ liệu và hiển thị (Realtime)
        function renderLeaderboardData() {
            // Query lấy top 50 điểm cao nhất (Firebase sort tăng dần, nên mình lấy 50 cái cuối cùng của score)
            // Lưu ý: Firebase sort tăng dần. Để lấy điểm cao nhất, ta lấy cuối danh sách rồi đảo ngược mảng ở client.
            const topScoresRef = query(ref(db, 'quiz_leaderboard'), orderByChild('score'), limitToLast(50));
            
            onValue(topScoresRef, (snapshot) => {
                const data = [];
                snapshot.forEach((childSnapshot) => {
                    data.push(childSnapshot.val());
                });
                
                // Đảo ngược mảng để điểm cao nhất lên đầu
                data.reverse();

                let html = '';
                if (data.length === 0) {
                    html = '<tr><td colspan="4" style="text-align:center;">Chưa có dữ liệu. Hãy là người đầu tiên!</td></tr>';
                } else {
                    data.forEach((entry, index) => {
                        let rankClass = '';
                        if (index === 0) rankClass = 'rank-1';
                        else if (index === 1) rankClass = 'rank-2';
                        else if (index === 2) rankClass = 'rank-3';

                        html += `<tr>
                            <td class="${rankClass}">#${index + 1}</td>
                            <td style="font-weight: 500;">${entry.name}</td>
                            <td style="font-weight: bold; color: var(--primary-color);">${entry.score}</td>
                            <td style="color: #777; font-size: 0.9em;">${entry.timestamp}</td>
                        </tr>`;
                    });
                }
                script_elements.leaderboardBody.innerHTML = html;
            });
        }

        // Expose hàm showLeaderboard ra window để button HTML gọi được
        window.showLeaderboard = function(fromSetup = false) {
            renderLeaderboardData(); // Kích hoạt lắng nghe dữ liệu
            script_elements.setupContainer.style.display = 'none';
            script_elements.quizContainer.style.display = 'none';
            script_elements.finalResultScreen.style.display = 'none';
            script_elements.leaderboardScreen.style.display = 'block';
        };

        script_elements.viewLeaderboardBtn.addEventListener('click', () => {
            window.showLeaderboard();
        });

        // ----------------------------------------------------
        // Logic Quiz (Giữ nguyên)
        // ----------------------------------------------------

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function prepareQuestions() {
            quizData = allQuestions; 
            quizData.forEach((q, index) => {
                q.id = index + 1; 
            });
        }

        script_elements.shuffleButton.addEventListener('click', () => {
            shuffleArray(quizData);
            script_elements.shuffleButton.textContent = 'Đã xáo trộn!';
            script_elements.shuffleButton.classList.add('shuffled');
            script_elements.shuffleButton.disabled = true;
        });

        script_elements.startButton.addEventListener('click', () => {
            const nameInput = script_elements.usernameInput.value.trim();
            if (!nameInput) {
                alert("Vui lòng nhập tên của bạn để bắt đầu!");
                script_elements.usernameInput.focus();
                return;
            }
            currentUsername = nameInput;
            script_elements.userCredit.textContent = currentUsername;

            script_elements.setupContainer.style.display = 'none';
            script_elements.quizContainer.style.display = 'block';
            script_elements.stickyHeader.style.display = 'flex';
            script_elements.submitButton.style.display = 'block';
            
            const selectedTimeInput = document.querySelector('input[name="time"]:checked');
            const durationInMinutes = selectedTimeInput ? parseInt(selectedTimeInput.value) : 30;
            startTimer(durationInMinutes);

            renderQuiz();
        });

        script_elements.submitButton.addEventListener('click', () => {
            if (confirm('Bạn có chắc chắn muốn nộp bài không?')) {
                endQuiz();
            }
        });

        function renderQuiz() {
            let html = '';
            quizData.forEach((q, index) => {
                const correctAnswerText = q.options[q.answer];
                let optionsArray = Object.keys(q.options).map(key => ({ key, text: q.options[key] }));
                shuffleArray(optionsArray);

                const shuffledOptions = {};
                let newAnswerKey = '';
                const newKeys = ['A', 'B', 'C', 'D', 'E'];

                optionsArray.forEach((option, i) => {
                    const currentKey = newKeys[i];
                    shuffledOptions[currentKey] = option.text;
                    if (option.text === correctAnswerText) {
                        newAnswerKey = currentKey;
                    }
                });
                
                q.shuffledAnswer = newAnswerKey;

                html += `<div class="question-block" id="q-block-${q.id}">`;
                html += `<p class="question-text">${index + 1}. ${q.question}</p>`;
                
                if (q.image) {
                    html += `<div style="text-align: center; margin-bottom: 15px;">
                                <img src="${q.image}" alt="Hình ảnh cho câu hỏi ${index + 1}" style="max-width: 100%; max-height: 250px; border-radius: 8px;">
                            </div>`;
                }

                html += `<fieldset id="fs-${q.id}">`;
                html += `<div class="options-container">`;
                for (const key in shuffledOptions) {
                    html += `<div>
                                <label>
                                    <input type="radio" name="q${q.id}" value="${key}">
                                    <span>${key}. ${shuffledOptions[key]}</span>
                                </label>
                            </div>`;
                }
                html += `</div></fieldset></div>`;
            });
            script_elements.quizForm.innerHTML = html;
        }

        function handleAnswerSelection(event) {
            const selectedRadio = event.target;
            if (selectedRadio.tagName !== 'INPUT' || selectedRadio.type !== 'radio') return;

            const questionId = parseInt(selectedRadio.name.substring(1));
            const userAnswer = selectedRadio.value;
            
            const questionData = quizData.find(q => q.id === questionId);
            if (!questionData || questionData.answeredCorrectly) {
                return;
            }

            const block = document.getElementById(`q-block-${questionId}`);
            block.classList.remove('correct', 'incorrect');
            Array.from(block.querySelectorAll('.options-container div')).forEach(div => {
                div.classList.remove('incorrect-option', 'correct-selection');
            });

            const isCorrect = userAnswer === questionData.shuffledAnswer;
            const selectedLabelDiv = selectedRadio.closest('div');

            if (isCorrect) {
                block.classList.add('correct');
                selectedLabelDiv.classList.add('correct-selection');
                document.getElementById(`fs-${questionId}`).disabled = true;
                questionData.answeredCorrectly = true;

                if (!incorrectlyAttemptedQuestions.includes(questionId)) {
                    score++;
                }
            } else {
                block.classList.add('incorrect');
                selectedLabelDiv.classList.add('incorrect-option');

                if (!incorrectlyAttemptedQuestions.includes(questionId)) {
                    incorrectlyAttemptedQuestions.push(questionId);
                }
            }
        }

        function startTimer(minutes) {
            let duration = minutes * 60;
            timerInterval = setInterval(() => {
                const mins = Math.floor(duration / 60);
                let secs = duration % 60;
                secs = secs < 10 ? '0' + secs : secs;

                script_elements.timerDisplay.textContent = `${mins}:${secs}`;
                
                if (duration < 60 && !script_elements.timerDisplay.classList.contains('ending')) {
                    script_elements.timerDisplay.classList.add('ending');
                }

                if (--duration < 0) {
                    endQuiz(true);
                }
            }, 1000);
        }

        function endQuiz(isTimeOut = false) {
            clearInterval(timerInterval);
            if (isTimeOut) {
                alert("Đã hết giờ làm bài!");
            }
            
            script_elements.stickyHeader.style.display = 'none';
            script_elements.quizContainer.style.display = 'none';
            script_elements.submitButton.style.display = 'none';

            const totalQuestions = quizData.length;
            document.getElementById('final-score-text').textContent = `Chúc mừng ${currentUsername}! Bạn đã đạt: ${score} / ${totalQuestions} điểm`;
            script_elements.finalResultScreen.style.display = 'block';

            // Gửi điểm lên Firebase
            saveScoreToLeaderboard(currentUsername, score);
        }
        
        prepareQuestions();
        script_elements.quizForm.addEventListener('click', handleAnswerSelection);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ch·∫•m C√¥ng UTC</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<svg width="0" height="0" style="position: absolute;">
  <defs>
    <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%">
      <feTurbulence type="fractalNoise" baseFrequency="0.025 0.025" numOctaves="2" seed="92" result="noise" />
      <feGaussianBlur in="noise" stdDeviation="2" result="blurred" />
      <feDisplacementMap in="SourceGraphic" in2="blurred" scale="65" xChannelSelector="R" yChannelSelector="G" />
    </filter>
  </defs>
</svg>

<div id="toast-container"></div>

<div id="offline-modal" class="overlay" style="z-index: 20000;">
    <div class="modal-box">
        <div style="font-size: 3.5rem; margin-bottom: 16px;">üì°</div>
        <h2 style="margin: 0 0 8px 0; color: var(--danger);">M·∫•t K·∫øt N·ªëi!</h2>
        <p style="color: var(--text-sub); margin-bottom: 24px;">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu m·ªõi.</p>
        <div class="flex-row">
            <button class="btn btn-primary flex-1" onclick="openWifiSettings()">C√†i ƒê·∫∑t</button>
            <button class="btn btn-outline flex-1" onclick="switchToOfflineMode()">Xem Offline</button>
        </div>
    </div>
</div>

<div id="confirm-modal" class="overlay">
    <div class="modal-box">
        <div style="font-size: 3.5rem; color: var(--danger); margin-bottom: 15px;">
            <i class="fa-solid fa-circle-exclamation"></i>
        </div>
        <h2 style="margin: 0 0 8px 0; color: var(--text-main);">X√°c Nh·∫≠n</h2>
        <p id="confirm-msg" style="color: var(--text-sub); margin-bottom: 24px; font-size: 0.95rem;">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
        <div class="flex-row">
            <button id="btn-confirm-yes" class="btn btn-primary flex-1" style="background: var(--danger); color: white;">ƒê·ªìng √ù</button>
            <button class="btn btn-outline flex-1" onclick="closeConfirmModal()">H·ªßy</button>
        </div>
    </div>
</div>

<div id="new-id-modal" class="overlay">
    <div class="modal-box">
        <div style="font-size: 3.5rem; margin-bottom: 16px;">üëã</div>
        <h2 style="margin: 0 0 8px 0;">Ph√°t hi·ªán ng∆∞·ªùi l·∫° ch·∫•m c√¥ng</h2>
        <h1 id="modal-id" style="font-size: 2.5rem; color: var(--primary); margin: 0 0 16px 0; font-weight: 800;">--</h1>
        <p style="color: var(--text-sub); margin-bottom: 24px;">ƒê√£ l∆∞u gi·ªù qu√©t. Th√™m t√™n ngay?</p>
        <div class="flex-row">
            <button class="btn btn-primary flex-1" onclick="acceptNewID()">Th√™m Ngay</button>
            <button class="btn btn-outline flex-1" onclick="closeNewID()">ƒê·ªÉ Sau</button>
        </div>
    </div>
</div>

<div id="password-modal" class="overlay">
    <div class="modal-box">
        <div style="font-size: 3rem; color: var(--primary); margin-bottom: 10px;">
            <i class="fa-solid fa-user-shield"></i>
        </div>
        <h2 style="margin: 0 0 20px 0;">ƒê·ªïi M·∫≠t Kh·∫©u</h2>
        
        <div style="text-align: left; margin-bottom: 15px; background: var(--bg-body); padding: 10px; border-radius: 12px;">
            <label style="font-size: 0.8rem; color: var(--text-sub); display: block; margin-bottom: 5px;">
                üîí C√¢u h·ªèi b·∫£o m·∫≠t <b>?</b>
            </label>
            <input type="text" id="secret-input" class="form-control" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." style="margin-bottom: 0;">
        </div>
        <hr style="border: 0; border-top: 1px solid var(--border); margin-bottom: 15px;">
        <input type="password" id="old-pass-input" class="form-control" placeholder="M·∫≠t kh·∫©u c≈©">
        <input type="password" id="new-pass-input" class="form-control" placeholder="M·∫≠t kh·∫©u m·ªõi">
        <input type="password" id="confirm-pass-input" class="form-control" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
        
        <div class="flex-row">
            <button class="btn btn-primary flex-1" onclick="saveNewPassword()">L∆∞u</button>
            <button class="btn btn-outline flex-1" onclick="closeChangePassModal()">H·ªßy</button>
        </div>
    </div>
</div>

<div id="login-page">
    <div class="login-card">
        <div style="font-size: 3rem; color: var(--primary); margin-bottom: 16px;"><i class="fa-solid fa-fingerprint"></i></div>
        <h2 style="margin-bottom: 8px;">H·ªá Th·ªëng Ch·∫•m C√¥ng</h2>
        <p style="color: var(--text-sub); margin-bottom: 32px; font-size: 0.9rem;">Vui l√≤ng ƒëƒÉng nh·∫≠p</p>
        <div class="role-group">
            <button class="role-btn active" onclick="switchRole('emp', this)">Nh√¢n Vi√™n</button>
            <button class="role-btn" onclick="switchRole('admin', this)">Qu·∫£n Tr·ªã</button>
        </div>
        
        <div id="form-emp">
            <select id="login-select" class="form-control"><option>ƒêang t·∫£i...</option></select>
            <label class="remember-check"><input type="checkbox" id="remember-emp"> Ghi nh·ªõ t√¥i</label>
            <button class="btn btn-primary" style="width:100%" onclick="loginEmp()">Xem L·ªãch S·ª≠</button>
        </div>

        <div id="form-admin" class="hidden">
            <input type="text" id="user" class="form-control" placeholder="T√™n ƒëƒÉng nh·∫≠p">
            <input type="password" id="pass" class="form-control" placeholder="M·∫≠t kh·∫©u">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <label class="remember-check" style="margin-bottom: 0;">
                    <input type="checkbox" id="remember-admin"> Ghi nh·ªõ
                </label>
                <button type="button" class="btn btn-outline" style="padding: 8px 12px; color: var(--primary); border-color: var(--primary);" onclick="biometricLogin()">
                    <i class="fa-solid fa-fingerprint" style="font-size: 1.2rem;"></i>
                </button>
            </div>

            <button class="btn btn-primary" style="width:100%" onclick="loginAdmin()">ƒêƒÉng Nh·∫≠p</button>
        </div>
    </div>
</div>

<nav class="sidebar" id="main-sidebar">
    <div class="logo"><i class="fa-solid fa-clock"></i> UTC Time</div>
    <div class="nav-link active" id="pc-dashboard" onclick="openTab('dashboard')"><i class="fa-solid fa-chart-pie"></i> T·ªïng Quan</div>
    <div class="nav-link" id="pc-live" onclick="openTab('live')"><i class="fa-solid fa-video"></i> Gi√°m S√°t</div>
    <div class="nav-link" id="pc-salary" onclick="openTab('salary')"><i class="fa-solid fa-money-bill-wave"></i> T√≠nh L∆∞∆°ng</div>
    <div class="nav-link" id="pc-users" onclick="openTab('users')"><i class="fa-solid fa-users"></i> Nh√¢n S·ª±</div>
    <div class="nav-link" id="pc-settings" onclick="openTab('settings')"><i class="fa-solid fa-gear"></i> C√†i ƒê·∫∑t</div>
</nav>

<div class="main-content">
    <div class="top-bar">
        <button class="btn btn-outline" style="width: auto; padding: 8px 12px;" onclick="toggleTheme()"><i class="fa-solid fa-moon"></i></button>
        <div style="display: flex; gap: 16px; align-items: center;">
            <div style="text-align: right;">
                <div id="display-name" style="font-weight: 600; font-size: 0.95rem;">Guest</div>
                <div id="display-role" style="font-size: 0.75rem; color: var(--text-sub);">User</div>
            </div>
            <button class="btn btn-danger" style="width: auto; padding: 8px 12px;" onclick="logout()"><i class="fa-solid fa-power-off"></i></button>
        </div>
    </div>

    <div class="content-scroll">
        <div id="view-emp" class="hidden">
            <div class="card">
                <h3>üìÖ L·ªãch S·ª≠ C·ªßa B·∫°n</h3>
                <div class="table-responsive"><table id="emp-table"><thead><tr><th>Th·ªùi Gian</th><th>Tr·∫°ng Th√°i</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>

        <div id="view-admin" class="hidden">
            <div id="tab-dashboard" class="tab-content active">
                <div class="flex-row">
                    <div class="card flex-1"><h3>T·ª∑ L·ªá H√¥m Nay</h3><canvas id="chartPie" style="max-height: 220px;"></canvas></div>
                    <div class="card flex-1"><h3>Th·ªëng K√™ 7 Ng√†y</h3><canvas id="chartBar" style="max-height: 220px;"></canvas></div>
                </div>
                <div class="card">
                    <h3>Th·ªëng K√™ Nhanh</h3>
                    <div class="flex-row">
                        <div class="card flex-1" style="text-align: center;"><div id="total-today" style="font-size: 2rem; font-weight: 700; color: var(--primary);">0</div><div style="color: var(--text-sub); font-size: 0.9rem;">L∆∞·ª£t Ch·∫•m</div></div>
                        <div class="card flex-1" style="text-align: center;"><div id="on-time-today" style="font-size: 2rem; font-weight: 700; color: var(--success);">0</div><div style="color: var(--text-sub); font-size: 0.9rem;">ƒê√∫ng Gi·ªù</div></div>
                        <div class="card flex-1" style="text-align: center;"><div id="late-today" style="font-size: 2rem; font-weight: 700; color: var(--danger);">0</div><div style="color: var(--text-sub); font-size: 0.9rem;">ƒêi Mu·ªôn</div></div>
                    </div>
                </div>
            </div>

            <div id="tab-live" class="tab-content hidden">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px">
                        <h3>Gi√°m S√°t Realtime</h3>
                        <div style="display:flex; align-items:center; gap:8px">
                            <span style="font-size:0.8rem; color:var(--text-sub)">Gi·ªù l√†m:</span>
                            <input type="time" id="work-time" value="08:00" class="form-control" style="width: auto; margin:0; padding:6px">
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table id="live-table">
                            <thead>
                            <tr>
                                <th width="30%">Nh√¢n Vi√™n</th>
                                <th width="30%">Chi Ti·∫øt</th>
                                <th width="25%">·∫¢nh Check-in</th> <th width="15%" style="text-align:center">X√≥a</th>
                            </tr>
                            </thead>
                            <tbody id="live-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-salary" class="tab-content hidden">
                <div class="card">
                    <div class="flex-row">
                        <div class="flex-1"><label style="font-size:0.8rem; font-weight:600">T·ª´ ng√†y:</label><input type="date" id="date-start" class="form-control"></div>
                        <div class="flex-1"><label style="font-size:0.8rem; font-weight:600">ƒê·∫øn ng√†y:</label><input type="date" id="date-end" class="form-control"></div>
                        <div class="flex-1"><label style="font-size:0.8rem; font-weight:600">L∆∞∆°ng/Gi·ªù:</label><input type="number" id="salary-val" class="form-control" value="500000"></div>
                    </div>
                    <div class="flex-row" style="margin-top:10px">
                        <button class="btn btn-primary flex-1" onclick="calcSalary()"><i class="fa-solid fa-calculator"></i> T√≠nh L∆∞∆°ng</button>
                        <button class="btn btn-outline flex-1" onclick="exportExcel()"><i class="fa-solid fa-file-excel"></i> Xu·∫•t Excel</button>
                        <button class="btn btn-danger flex-1" onclick="triggerDeleteData()"><i class="fa-solid fa-trash"></i> X√≥a D·ªØ Li·ªáu</button>
                    </div>
                </div>
                <div class="card"><h3>K·∫øt Qu·∫£: <span id="total-money" style="color:var(--success)">0 ƒë</span></h3><div class="table-responsive"><table id="salary-table"><thead><tr><th>M√£</th><th>T√™n</th><th>S·ªë C√¥ng</th><th>Th·ª±c Lƒ©nh</th></tr></thead><tbody></tbody></table></div></div>
            </div>

            <div id="tab-users" class="tab-content hidden">
                <div class="flex-row">
                    <div class="card flex-1">
                        <h3>Th√¥ng Tin</h3>
                        <input type="text" id="inp-id" class="form-control" placeholder="ID Nh√¢n vi√™n">
                        <input type="text" id="inp-code" class="form-control" placeholder="M√£ NV">
                        <input type="text" id="inp-name" class="form-control" placeholder="H·ªç v√† T√™n">
                        <div class="flex-row">
                            <button class="btn btn-primary flex-1" onclick="saveUser()">L∆∞u</button>
                            <button class="btn btn-danger flex-1 hidden" id="btn-del-user" onclick="triggerDeleteUser()">X√≥a</button>
                        </div>
                        <button class="btn btn-outline" style="width:100%; margin-top:12px" onclick="resetForm()">L√†m m·ªõi</button>
                    </div>
                    <div class="card flex-1">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <h3 style="margin:0;">Nh√¢n S·ª±</h3>
                            <div class="user-toggle">
                                <button id="btn-users-main" class="user-toggle-btn active" type="button" onclick="switchUserView('main')">Danh s√°ch</button>
                                <button id="btn-users-trash" class="user-toggle-btn" type="button" onclick="switchUserView('trash')">ƒê√£ xo√° <span id="deleted-count" style="font-size:0.7rem; opacity:.8;">(0)</span></button>
                            </div>
                        </div>
                        <div id="users-main-wrapper" class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table id="users-list">
                                <thead><tr><th>ID</th><th>M√É</th><th>T√äN</th></tr></thead>
                                <tbody id="user-table-body"></tbody> </table>
                        </div>                        <div id="users-trash-wrapper" class="table-responsive hidden" style="max-height: 400px; overflow-y: auto;"><table id="users-trash-list"><thead><tr><th style="width:60px;">ID</th><th>M√É</th><th>T√äN</th><th style="text-align:center; width:90px;">Kh√¥i ph·ª•c</th></tr></thead><tbody></tbody></table></div>
                    </div>
                </div>
            </div>

            <div id="tab-settings" class="tab-content hidden">
                <div class="card">
                    <h3>C√†i ƒê·∫∑t</h3>
                    <div class="settings-list">
                        <div class="settings-item" onclick="openChangePassModal()">
                            <div style="display:flex; align-items:center; gap:15px">
                                <div class="settings-icon"><i class="fa-solid fa-key"></i></div>
                                <div><div style="font-weight:600; color:var(--text-main)">ƒê·ªïi M·∫≠t Kh·∫©u</div><div style="font-size:0.8rem; color:var(--text-sub)">Thay ƒë·ªïi m·∫≠t kh·∫©u Admin</div></div>
                            </div>
                            <i class="fa-solid fa-chevron-right" style="color:var(--text-sub)"></i>
                        </div>

                        <div class="settings-item" onclick="openTrashView()">
                            <div style="display:flex; align-items:center; gap:15px">
                                <div class="settings-icon"><i class="fa-solid fa-trash-can"></i></div>
                                <div><div style="font-weight:600; color:var(--text-main)">Th√πng R√°c</div><div style="font-size:0.8rem; color:var(--text-sub)">Kh√¥i ph·ª•c d·ªØ li·ªáu ƒë√£ x√≥a</div></div>
                            </div>
                            <i class="fa-solid fa-chevron-right" style="color:var(--text-sub)"></i>
                        </div>

                        <div class="settings-item" onclick="showToast('Zalo: 0394590931', 'info')">
                            <div style="display:flex; align-items:center; gap:15px">
                                <div class="settings-icon"><i class="fa-solid fa-headset"></i></div>
                                <div><div style="font-weight:600; color:var(--text-main)">Li√™n H·ªá K·ªπ Thu·∫≠t</div><div style="font-size:0.8rem; color:var(--text-sub)">H·ªó tr·ª£ l·ªói v√† b·∫£o tr√¨</div></div>
                            </div>
                            <i class="fa-solid fa-chevron-right" style="color:var(--text-sub)"></i>
                        </div>

                        <div class="settings-item">
                            <div style="display:flex; align-items:center; gap:15px">
                                <div class="settings-icon"><i class="fa-solid fa-code-branch"></i></div>
                                <div><div style="font-weight:600; color:var(--text-main)">Phi√™n B·∫£n</div><div style="font-size:0.8rem; color:var(--text-sub)">v22.0 (Stable)</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-trash-detail" class="tab-content hidden">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px">
                        <div style="display:flex; align-items:center; gap:10px"><button class="btn btn-outline" style="padding:6px 10px" onclick="openTab('settings')"><i class="fa-solid fa-arrow-left"></i></button><h3 style="margin:0; color:var(--danger)">Th√πng R√°c</h3></div>
                        <button class="btn btn-danger" style="font-size:0.8rem; padding:6px 12px" onclick="emptyTrash()">D·ªçn s·∫°ch</button>
                    </div>
                    <div class="table-responsive"><table id="trash-table"><thead><tr><th>Nh√¢n Vi√™n</th><th>Th·ªùi Gian</th><th style="text-align:center">Thao T√°c</th></tr></thead><tbody id="trash-body"></tbody></table></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bottom-nav" id="mobile-nav">
    <div class="b-nav-item active" id="mob-dashboard" onclick="openTab('dashboard')"><i class="fa-solid fa-chart-pie"></i><span>T·ªïng Quan</span></div>
    <div class="b-nav-item" id="mob-live" onclick="openTab('live')"><i class="fa-solid fa-video"></i><span>Gi√°m S√°t</span></div>
    <div class="b-nav-item" id="mob-salary" onclick="openTab('salary')"><i class="fa-solid fa-money-bill-wave"></i><span>L∆∞∆°ng</span></div>
    <div class="b-nav-item" id="mob-users" onclick="openTab('users')"><i class="fa-solid fa-users"></i><span>Nh√¢n S·ª±</span></div>
    <div class="b-nav-item" id="mob-settings" onclick="openTab('settings')"><i class="fa-solid fa-gear"></i><span>C√†i ƒê·∫∑t</span></div>
</div>

<script src="./js/script.js"></script>
</body>
</html>